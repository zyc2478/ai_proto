<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>Flixor.ai - Stylize Vide</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      background: linear-gradient(135deg, #6a82fb 0%, #fc5c7d 100%);
      color: #222;
      font-family: 'Segoe UI', Arial, sans-serif;
      margin: 0;
      min-height: 100vh;
    }
    .nav {
      background: rgba(255,255,255,0.95);
      border-bottom: 1px solid #e0e0e0;
      padding: 0 0 0 0;
      position: sticky;
      top: 0;
      z-index: 10;
      display: flex;
      align-items: center;
      height: 70px;
      box-shadow: 0 2px 12px 0 rgba(106,130,251,0.07);
    }
    .logo {
      font-size: 2.2rem;
      font-weight: bold;
      color: #6a82fb;
      letter-spacing: 2px;
      margin-left: 40px;
    }
    .subtitle {
      color: #888;
      font-size: 1.2rem;
      margin-left: 12px;
      font-weight: 500;
    }
    .nav a {
      color: #333;
      text-decoration: none;
      margin: 0 28px;
      font-weight: 500;
      font-size: 1.1rem;
      transition: color 0.2s;
      padding: 8px 0;
      border-bottom: 2px solid transparent;
    }
    .nav a.active, .nav a:hover {
      color: #6a82fb;
      border-bottom: 2px solid #6a82fb;
    }
    .section {
      max-width: 1200px;
      margin: 48px auto 0 auto;
      background: rgba(255,255,255,0.98);
      border-radius: 18px;
      box-shadow: 0 8px 32px 0 rgba(106,130,251,0.10);
      padding: 48px 56px 56px 56px;
      min-height: 600px;
    }
    .banner {
      background: linear-gradient(90deg, #6a82fb 0%, #fc5c7d 100%);
      padding: 60px 0 40px 0;
      text-align: center;
      border-radius: 16px;
      color: #fff;
      margin-bottom: 40px;
      box-shadow: 0 4px 24px 0 rgba(106,130,251,0.10);
    }
    .banner h1 {
      font-size: 2.6rem;
      font-weight: 700;
      margin-bottom: 18px;
      letter-spacing: 1px;
    }
    .main-btn, .import-btn, .gen-btn, .add-btn, .compose-btn {
      background: #6a82fb;
      color: #fff;
      border: none;
      padding: 10px 26px;
      border-radius: 8px;
      cursor: pointer;
      margin-left: 8px;
      font-size: 1rem;
      font-weight: 500;
      box-shadow: 0 2px 8px 0 rgba(106,130,251,0.10);
      transition: background 0.2s, box-shadow 0.2s;
    }
    .main-btn {
      padding: 18px 60px;
      font-size: 1.4rem;
      border-radius: 12px;
      margin: 32px 0;
      font-weight: 600;
    }
    .main-btn:hover, .import-btn:hover, .gen-btn:hover, .add-btn:hover, .compose-btn:hover {
      background: #5a6eea;
      box-shadow: 0 4px 16px 0 rgba(106,130,251,0.18);
    }
    .info-stream {
      display: flex;
      flex-wrap: wrap;
      gap: 32px;
      justify-content: center;
      margin: 40px 0;
    }
    .info-card {
      background: linear-gradient(135deg, #e0e7ff 0%, #f3e7e9 100%);
      border-radius: 16px;
      box-shadow: 0 2px 12px 0 rgba(106,130,251,0.08);
      width: 340px;
      padding: 32px 24px;
      transition: transform 0.2s, box-shadow 0.2s;
      border: 1px solid #e0e0e0;
    }
    .info-card:hover {
      transform: translateY(-6px) scale(1.03);
      box-shadow: 0 8px 32px 0 rgba(106,130,251,0.18);
    }
    .info-card h3 {
      color: #6a82fb;
      font-size: 1.3rem;
      margin-bottom: 10px;
    }
    .input-row {
      margin-bottom: 28px;
    }
    .input-row label {
      display: block;
      margin-bottom: 8px;
      color: #6a82fb;
      font-weight: 500;
      font-size: 1.08rem;
    }
    .input-row input, .input-row textarea, .input-row select {
      width: 100%;
      padding: 13px 14px;
      border: 1.5px solid #d1d5db;
      border-radius: 8px;
      font-size: 1.08rem;
      background: #f7f8fa;
      transition: border 0.2s;
      margin-bottom: 4px;
    }
    .input-row input:focus, .input-row textarea:focus, .input-row select:focus {
      border: 1.5px solid #6a82fb;
      outline: none;
    }
    .material-list, .scene-list, .clip-list, .plot-list {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      margin: 16px 0;
    }
    .material-item, .scene-item, .clip-item, .plot-item {
      background: linear-gradient(135deg, #e0e7ff 0%, #f3e7e9 100%);
      border-radius: 10px;
      padding: 18px 20px;
      min-width: 120px;
      text-align: center;
      font-size: 1.08rem;
      color: #333;
      box-shadow: 0 2px 8px 0 rgba(106,130,251,0.07);
      border: 1px solid #e0e0e0;
    }
    .storyboard-section {
      margin-bottom: 36px;
    }
    .storyboard-img {
      width: 140px;
      height: 90px;
      background: linear-gradient(135deg, #e0e7ff 0%, #f3e7e9 100%);
      border-radius: 8px;
      display: inline-block;
      margin-right: 16px;
      box-shadow: 0 2px 8px 0 rgba(106,130,251,0.07);
      border: 1px solid #e0e0e0;
    }
    .effect-select {
      margin-top: 18px;
    }
    .compose-btn {
      margin-top: 18px;
      padding: 14px 40px;
      font-size: 1.15rem;
    }
    @media (max-width: 900px) {
      .section { padding: 24px 8vw; }
      .info-stream { flex-direction: column; align-items: center; }
    }
    @media (max-width: 600px) {
      .section { padding: 12px 2vw; min-height: 400px; }
      .banner h1 { font-size: 1.3rem; }
      .main-btn { padding: 12px 20px; font-size: 1rem; }
      .info-card { width: 90vw; padding: 18px 8px; }
    }
    .nav svg.icon {
      width: 1.3em;
      height: 1.3em;
      vertical-align: middle;
      margin-right: 6px;
      fill: #6a82fb;
      display: inline-block;
    }
    .video-masonry {
      column-count: 4;
      column-gap: 32px;
      width: 100%;
      max-height: 800px;
      overflow-y: auto;
      overflow-x: hidden;
      margin-bottom: 24px;
    }
    .video-card {
      background: #e0e7ff;
      border-radius: 16px;
      box-shadow: 0 2px 12px 0 rgba(106,130,251,0.08);
      margin-bottom: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
      color: #b3b8d0;
      break-inside: avoid;
      width: 100%;
    }
    @media (max-width: 1200px) {
      .video-masonry { column-count: 2; }
    }
    @media (max-width: 700px) {
      .video-masonry { column-count: 1; }
    }
    .img-toolbar {
      position: absolute;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      display: flex;
      gap: 18px;
      background: rgba(255,255,255,0.95);
      border-radius: 32px;
      box-shadow: 0 4px 16px rgba(106,130,251,0.10);
      padding: 8px 20px;
      z-index: 10;
      align-items: center;
    }
    .img-toolbar-btn {
      background: none;
      border: none;
      outline: none;
      border-radius: 50%;
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.18s, box-shadow 0.18s;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(106,130,251,0.08);
    }
    .img-toolbar-btn:hover {
      background: #e0e7ff;
      box-shadow: 0 4px 16px rgba(106,130,251,0.18);
    }
    .img-toolbar-btn svg {
      display: block;
    }
    .replace-popover {
      display: flex;
      align-items: center;
      gap: 8px;
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 2px 12px rgba(106,130,251,0.13);
      padding: 6px 14px;
      border: 1.5px solid #e0e7ff;
      font-size: 15px;
    }
    .replace-input {
      border: 1px solid #d1d5db;
      border-radius: 8px;
      padding: 4px 8px;
      font-size: 15px;
      outline: none;
      transition: border 0.18s;
    }
    .replace-input:focus {
      border: 1.5px solid #6a82fb;
    }
    .replace-confirm {
      background: linear-gradient(90deg,#6a82fb,#fc5c7d);
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 4px 14px;
      font-size: 15px;
      cursor: pointer;
      transition: background 0.18s;
    }
    .replace-confirm:hover {
      background: linear-gradient(90deg,#fc5c7d,#6a82fb);
    }
    .replace-progress-bar {
      position: absolute;
      left: 50%;
      top: 18px;
      transform: translateX(-50%);
      width: 60%;
      height: 8px;
      background: #e0e7ff;
      border-radius: 8px;
      overflow: hidden;
      z-index: 20;
      box-shadow: 0 2px 8px rgba(106,130,251,0.10);
    }
    .replace-progress-inner {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg,#6a82fb,#fc5c7d);
      border-radius: 8px;
      transition: width 2s cubic-bezier(.4,1,.6,1);
    }
    .toolbar-action-input {
      display: flex;
      align-items: center;
      gap: 8px;
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 2px 12px rgba(106,130,251,0.13);
      padding: 16px 24px;
      border: 1.5px solid #e0e7ff;
      font-size: 15px;
    }
    .replace-progress-bar {
      width: 220px;
      height: 10px;
      background: #e0e7ff;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(106,130,251,0.10);
      margin: 0 auto;
    }
    .replace-progress-inner {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg,#6a82fb,#fc5c7d);
      border-radius: 8px;
      transition: width 1s cubic-bezier(.4,1,.6,1);
    }
  </style>
</head>
<body>

<!-- 顶部导航 -->
<div class="nav">
  <span class="logo" style="position:relative;display:inline-flex;align-items:baseline;">
    Flixor
    <span class="subtitle" style="margin-left:8px;font-size:0.9rem;color:#b3b8d0;font-weight:400;line-height:1;">Stylized Video</span>
  </span>
  <a href="#home" class="active"><svg class="icon" viewBox="0 0 24 24"><path d="M3 10.5L12 4l9 6.5V20a1 1 0 0 1-1 1h-5v-5h-6v5H4a1 1 0 0 1-1-1V10.5z"/></svg>Home</a>
  <span style="margin:0 18px;color:#d1d5db;">|</span>
  <a href="#brief">Story</a>
  <span style="margin:0 18px;color:#d1d5db;">|</span>
  <a href="#storyboard">StoryBoard</a>
  <span style="margin:0 18px;color:#d1d5db;">|</span>
  <a href="#material">Image</a>
  <span style="margin:0 18px;color:#d1d5db;">|</span>
  <a href="#clip">Clip</a>
  <span style="margin:0 18px;color:#d1d5db;">|</span>
  <a href="#compose">Video</a>
</div>

<!-- 页面1：主页 -->
<div id="home" class="section">
  <div class="banner">
    <h1>释放你的创意，AI驱动视频创作</h1>
    <button class="main-btn" onclick="showPage('brief')">立即创作</button>
  </div>
  <div class="info-row" style="display:flex;gap:32px;justify-content:space-between;margin:40px 0 48px 0;">
    <div class="info-card" style="flex:1;min-width:200px;max-width:280px;display:flex;flex-direction:column;align-items:center;justify-content:center;">
      <h3 style="color:#6a82fb;font-size:1.25rem;font-weight:700;margin-bottom:12px;">AI素材</h3>
      <div style="font-size:1.05rem;text-align:center;margin-bottom:8px;">为品牌生成AI 5s的短片镜头</div>
    </div>
    <div class="info-card" style="flex:1;min-width:200px;max-width:280px;display:flex;flex-direction:column;align-items:center;justify-content:center;">
      <h3 style="color:#6a82fb;font-size:1.25rem;font-weight:700;margin-bottom:12px;">品牌宣传片</h3>
      <div style="font-size:1.05rem;text-align:center;margin-bottom:8px;">为品牌生成风格化的tvc视频</div>
    </div>
    <div class="info-card" style="flex:1;min-width:200px;max-width:280px;display:flex;flex-direction:column;align-items:center;justify-content:center;">
      <h3 style="color:#6a82fb;font-size:1.25rem;font-weight:700;margin-bottom:12px;">种草视频</h3>
      <div style="font-size:1.05rem;text-align:center;margin-bottom:8px;">为品牌生成AI种草类视频</div>
    </div>
    <div class="info-card" style="flex:1;min-width:200px;max-width:280px;display:flex;flex-direction:column;align-items:center;justify-content:center;">
      <h3 style="color:#6a82fb;font-size:1.25rem;font-weight:700;margin-bottom:12px;">产品介绍</h3>
      <div style="font-size:1.05rem;text-align:center;margin-bottom:8px;">为品牌生成产品介绍视频</div>
    </div>
  </div>
  <div class="video-masonry">
    <div class="video-card" style="height:180px;">视频封面1</div>
    <div class="video-card" style="height:260px;">视频封面2</div>
    <div class="video-card" style="height:210px;">视频封面3</div>
    <div class="video-card" style="height:320px;">视频封面4</div>
    <div class="video-card" style="height:200px;">视频封面5</div>
    <div class="video-card" style="height:280px;">视频封面6</div>
    <div class="video-card" style="height:170px;">视频封面7</div>
    <div class="video-card" style="height:230px;">视频封面8</div>
    <div class="video-card" style="height:190px;">视频封面9</div>
    <div class="video-card" style="height:250px;">视频封面10</div>
    <div class="video-card" style="height:220px;">视频封面11</div>
    <div class="video-card" style="height:300px;">视频封面12</div>
    <div class="video-card" style="height:210px;">视频封面13</div>
    <div class="video-card" style="height:270px;">视频封面14</div>
    <div class="video-card" style="height:160px;">视频封面15</div>
    <div class="video-card" style="height:240px;">视频封面16</div>
    <div class="video-card" style="height:200px;">视频封面17</div>
    <div class="video-card" style="height:260px;">视频封面18</div>
    <div class="video-card" style="height:180px;">视频封面19</div>
    <div class="video-card" style="height:220px;">视频封面20</div>
  </div>
</div>

<!-- 页面2：Brief页面 -->
<div id="brief" class="section" style="display:none;">
  <div style="display:flex;justify-content:space-between;align-items:center;">
    <h2>生成Story</h2>
    <button class="import-btn">导入Story</button>
  </div>
  <div class="input-row">
    <label>品牌名称</label>
    <input type="text" placeholder="请输入品牌名称">
  </div>
  <div class="input-row">
    <label>产品名称</label>
    <input type="text" placeholder="请输入产品名称">
  </div>
  <div class="input-row">
    <label>主题</label>
    <input type="text" placeholder="请输入视频主题">
    <button class="import-btn">生成主题</button>
  </div>
  <div class="input-row">
    <label>参考链接
      <span style="display:inline-block;cursor:pointer;color:#b3b8d0;font-weight:bold;font-size:0.95em;" title="品牌官方的电商店铺链接，比如京东、淘宝、天猫等官方链接">？</span>
    </label>
    <input type="text" placeholder="请输入参考链接">
  </div>
  <div class="input-row">
    <label>Brief Story</label>
    <textarea rows="3" placeholder="自动生成或导入Brief Story"></textarea>
    <button class="gen-btn">生成 Story</button>
  </div>
  <button class="main-btn" onclick="showPage('storyboard')">下一步：生成StoryBoard</button>
</div>

<!-- 页面3：选择/生成图像 -->
<div id="material" class="section" style="display:none;">
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:32px;">
    <div style="font-size:24px;font-weight:600;">选择/生成图像</div>
    <button onclick="showPage('storyboard')" style="padding:8px 16px;background:#6a82fb;color:white;border:none;border-radius:8px;cursor:pointer;font-weight:500;">返回</button>
  </div>
  <div style="position:relative;margin-bottom:32px;display:flex;justify-content:center;">
    <button onclick="scrollShots('left')" style="position:absolute;left:0;top:50%;transform:translateY(-50%);background:#6a82fb;color:white;border:none;border-radius:50%;width:40px;height:40px;cursor:pointer;font-size:22px;z-index:2;">&lt;</button>
    <div id="shotsContainer" style="width:1104px;max-width:100vw;overflow:hidden;position:relative;padding:16px 0;">
      <div id="shotsInner" style="display:flex;gap:24px;transition:transform 0.3s;will-change:transform;">
        <div class="shot-thumb" data-index="0" onclick="selectShot(this)" style="width:260px;height:180px;background:#e0e7ff;border-radius:16px;cursor:pointer;display:flex;align-items:flex-start;justify-content:flex-start;position:relative;">
          <img src="img/1-1.jpeg" style="width:100%;height:100%;object-fit:cover;border-radius:16px;">
          <span style="position:absolute;left:14px;top:14px;color:#333;font-weight:500;background:rgba(255,255,255,0.7);border-radius:8px;padding:2px 12px;">镜头1</span>
        </div>
        <div class="shot-thumb" data-index="1" onclick="selectShot(this)" style="width:260px;height:180px;background:#e0e7ff;border-radius:16px;cursor:pointer;display:flex;align-items:flex-start;justify-content:flex-start;position:relative;">
          <img src="img/2-1.jpeg" style="width:100%;height:100%;object-fit:cover;border-radius:16px;">
          <span style="position:absolute;left:14px;top:14px;color:#333;font-weight:500;background:rgba(255,255,255,0.7);border-radius:8px;padding:2px 12px;">镜头2</span>
        </div>
        <div class="shot-thumb" data-index="2" onclick="selectShot(this)" style="width:260px;height:180px;background:#e0e7ff;border-radius:16px;cursor:pointer;display:flex;align-items:flex-start;justify-content:flex-start;position:relative;">
          <img src="img/3-1.jpeg" style="width:100%;height:100%;object-fit:cover;border-radius:16px;">
          <span style="position:absolute;left:14px;top:14px;color:#333;font-weight:500;background:rgba(255,255,255,0.7);border-radius:8px;padding:2px 12px;">镜头3</span>
        </div>
        <div class="shot-thumb" data-index="3" onclick="selectShot(this)" style="width:260px;height:180px;background:#e0e7ff;border-radius:16px;cursor:pointer;display:flex;align-items:flex-start;justify-content:flex-start;position:relative;">
          <img src="img/4-1.jpeg" style="width:100%;height:100%;object-fit:cover;border-radius:16px;">
          <span style="position:absolute;left:14px;top:14px;color:#333;font-weight:500;background:rgba(255,255,255,0.7);border-radius:8px;padding:2px 12px;">镜头4</span>
        </div>
        <div class="shot-thumb" data-index="4" onclick="selectShot(this)" style="width:260px;height:180px;background:#e0e7ff;border-radius:16px;cursor:pointer;display:flex;align-items:flex-start;justify-content:flex-start;position:relative;">
          <img src="img/5-1.jpeg" style="width:100%;height:100%;object-fit:cover;border-radius:16px;">
          <span style="position:absolute;left:14px;top:14px;color:#333;font-weight:500;background:rgba(255,255,255,0.7);border-radius:8px;padding:2px 12px;">镜头5</span>
        </div>
        <div class="shot-thumb" data-index="5" onclick="selectShot(this)" style="width:260px;height:180px;background:#e0e7ff;border-radius:16px;cursor:pointer;display:flex;align-items:flex-start;justify-content:flex-start;position:relative;">
          <img src="img/6-1.jpeg" style="width:100%;height:100%;object-fit:cover;border-radius:16px;">
          <span style="position:absolute;left:14px;top:14px;color:#333;font-weight:500;background:rgba(255,255,255,0.7);border-radius:8px;padding:2px 12px;">镜头6</span>
        </div>
        <div class="shot-thumb" data-index="6" onclick="selectShot(this)" style="width:260px;height:180px;background:#e0e7ff;border-radius:16px;cursor:pointer;display:flex;align-items:flex-start;justify-content:flex-start;position:relative;">
          <img src="img/7-1.jpeg" style="width:100%;height:100%;object-fit:cover;border-radius:16px;">
          <span style="position:absolute;left:14px;top:14px;color:#333;font-weight:500;background:rgba(255,255,255,0.7);border-radius:8px;padding:2px 12px;">镜头7</span>
        </div>
      </div>
    </div>
    <button onclick="scrollShots('right')" style="position:absolute;right:0;top:50%;transform:translateY(-50%);background:#6a82fb;color:white;border:none;border-radius:50%;width:40px;height:40px;cursor:pointer;font-size:22px;z-index:2;">&gt;</button>
  </div>
  <div style="margin-bottom:32px;">
    <div style="font-weight:600;margin-bottom:16px;">生图提示词</div>
    <textarea id="promptText" style="width:100%;height:120px;padding:12px;border:1px solid #e5e7eb;border-radius:8px;resize:none;font-family:inherit;" placeholder="选择镜头后，这里会显示对应的文字描述..."></textarea>
  </div>
  <div style="margin-bottom:32px;">
    <button id="generateBtn" style="width:100%;padding:12px;background:#6a82fb;color:white;border:none;border-radius:8px;cursor:pointer;font-weight:500;" onclick="generateImages()">生成图像</button>
    <button id="uploadBtn" style="width:100%;padding:12px;background:#f3f4f6;color:#6a82fb;border:none;border-radius:8px;cursor:pointer;font-weight:500;margin-top:12px;">上传图像</button>
    <button id="uploadSubmitBtn" style="width:100%;padding:12px;background:#6a82fb;color:white;border:none;border-radius:8px;cursor:pointer;font-weight:500;margin-top:12px;" onclick="submitUpload()">提交</button>
    <div id="progressBar" style="width:100%;height:4px;background:#e0e7ff;border-radius:2px;margin-top:16px;display:none;">
      <div id="progressFill" style="width:0%;height:100%;background:#6a82fb;border-radius:2px;transition:width 2s;"></div>
    </div>
  </div>
  <div id="generatedImages" style="display:none;margin-bottom:32px;">
    <div style="font-weight:600;margin-bottom:16px;">生成的图像</div>
    <div id="genImgGrid" style="display:grid;grid-template-columns:repeat(2,1fr);gap:16px;">
      <!-- 这里动态填充图片或占位框 -->
    </div>
  </div>
  <script>
    // 全局变量声明
    let lastImgToolbar = null;
    let shotScrollIndex = 0;
    let currentShotIndex = 0;
    let submittedShots = Array(7).fill(false);
    let clipShotScrollIndex = 0;
    let currentClipShotIndex = 0;
    let selectedClipIndex = null;

    // 全局函数定义
    function showPage(page) {
      console.log('Switching to page:', page);
      
      // 隐藏所有页面
      ['home', 'brief', 'material', 'storyboard', 'clip', 'compose'].forEach(function(id) {
        const element = document.getElementById(id);
        if (element) {
          if (id === page) {
            element.style.display = 'block';
            console.log('Showing element:', id);
          } else {
            element.style.display = 'none';
            console.log('Hiding element:', id);
          }
        } else {
          console.log('Element not found:', id);
        }
      });
      
      // 更新导航高亮
      document.querySelectorAll('.nav a').forEach(function(a) {
        const isActive = a.getAttribute('href') === '#' + page;
        a.classList.toggle('active', isActive);
        console.log('Nav link:', a.getAttribute('href'), 'active:', isActive);
      });
    }

    // 页面初始化
    document.addEventListener('DOMContentLoaded', function() {
      // 导航点击切换
      document.querySelectorAll('.nav a').forEach(function(a) {
        a.addEventListener('click', function(e) {
          e.preventDefault();
          const page = a.getAttribute('href').replace('#', '');
          console.log('Nav clicked:', page);
          showPage(page);
        });
      });

      // 页面加载时根据hash显示对应页面
      const hash = location.hash.replace('#', '') || 'home';
      console.log('Initial hash:', hash);
      showPage(hash);

      // hash变化时切换页面
      window.addEventListener('hashchange', function() {
        const hash = location.hash.replace('#', '') || 'home';
        console.log('Hash changed:', hash);
        showPage(hash);
      });

      // 初始化默认选中镜头1
      selectClipShot(document.querySelector('.clip-shot-thumb[data-index="0"]'));
    });

    function generateImages() {
      const progressBar = document.getElementById('progressBar');
      const progressFill = document.getElementById('progressFill');
      const generatedImages = document.getElementById('generatedImages');
      const genImgGrid = document.getElementById('genImgGrid');
      progressBar.style.display = 'block';
      progressFill.style.width = '0%';
      generatedImages.style.display = 'block';
      genImgGrid.innerHTML = '';
      for(let i=0;i<4;i++){
        genImgGrid.innerHTML += `<div style='aspect-ratio:1;background:#e0e7ff;border-radius:12px;position:relative;overflow:hidden;cursor:pointer;' onclick='selectGeneratedImage(this, event)'></div>`;
      }
      setTimeout(() => {
        progressFill.style.width = '100%';
      }, 50);
      setTimeout(() => {
        genImgGrid.innerHTML = '';
        const shotNum = currentShotIndex + 1;
        for(let i=1;i<=4;i++){
          genImgGrid.innerHTML += `<div style='aspect-ratio:1;background:#e0e7ff;border-radius:12px;overflow:hidden;position:relative;cursor:pointer;' onclick='selectGeneratedImage(this, event)'><img src='img/shot${shotNum}-${i}.jpeg' style='width:100%;height:100%;object-fit:cover;border-radius:12px;'></div>`;
        }
        progressBar.style.display = 'none';
      }, 2000);
    }
    function scrollShots(direction) {
      const maxIndex = 3;
      const totalShots = 7;
      if (direction === 'left') {
        shotScrollIndex = Math.max(0, shotScrollIndex - 1);
      } else {
        shotScrollIndex = Math.min(totalShots - 4, shotScrollIndex + 1);
      }
      document.getElementById('shotsInner').style.transform = `translateX(-${shotScrollIndex * 284}px)`;
    }
    function selectShot(element) {
      // 选中高亮
      document.querySelectorAll('.shot-thumb').forEach(e => e.style.boxShadow = 'none');
      element.style.boxShadow = '0 0 0 3px #6a82fb';
      // 获取索引并显示提示词
      const idx = parseInt(element.getAttribute('data-index'));
      currentShotIndex = idx;
      document.getElementById('promptText').value = shotPrompts[idx] || '';
    }
    function generateImages() {
      const progressBar = document.getElementById('progressBar');
      const progressFill = document.getElementById('progressFill');
      const generatedImages = document.getElementById('generatedImages');
      const genImgGrid = document.getElementById('genImgGrid');
      progressBar.style.display = 'block';
      progressFill.style.width = '0%';
      generatedImages.style.display = 'block';
      genImgGrid.innerHTML = '';
      for(let i=0;i<4;i++){
        genImgGrid.innerHTML += `<div style='aspect-ratio:1;background:#e0e7ff;border-radius:12px;position:relative;overflow:hidden;cursor:pointer;' onclick='selectGeneratedImage(this, event)'></div>`;
      }
      setTimeout(() => {
        progressFill.style.width = '100%';
      }, 50);
      setTimeout(() => {
        genImgGrid.innerHTML = '';
        const shotNum = currentShotIndex + 1;
        for(let i=1;i<=4;i++){
          genImgGrid.innerHTML += `<div style='aspect-ratio:1;background:#e0e7ff;border-radius:12px;overflow:hidden;position:relative;cursor:pointer;' onclick='selectGeneratedImage(this, event)'><img src='img/shot${shotNum}-${i}.jpeg' style='width:100%;height:100%;object-fit:cover;border-radius:12px;'></div>`;
        }
        progressBar.style.display = 'none';
      }, 2000);
    }
    // 删除重复的lastImgToolbar声明
    function selectGeneratedImage(element, event) {
      // 移除上一个工具栏
      if(lastImgToolbar) lastImgToolbar.remove();
      // 工具栏HTML（美化+新SVG图标）
      const toolbar = document.createElement('div');
      toolbar.className = 'img-toolbar';
      toolbar.innerHTML = `
        <button class='img-toolbar-btn' title='一键换商品'>
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#6a82fb" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <ellipse cx="12" cy="15" rx="5" ry="6"/>
            <rect x="10" y="3" width="4" height="4" rx="1"/>
            <path d="M12 7v2"/>
            <path d="M16 5c2 0 2 2 0 2"/>
          </svg>
        </button>
        <button class='img-toolbar-btn' title='一键换衣'>
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#6a82fb" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="7" y="4" width="10" height="3" rx="1"/>
            <path d="M7 7c-1 6-2 10-2 13h14c0-3-1-7-2-13"/>
            <path d="M9 7c0 5-1 10-1 10"/>
            <path d="M12 7v10"/>
            <path d="M15 7c0 5 1 10 1 10"/>
          </svg>
        </button>
        <button class='img-toolbar-btn' title='一键换脸'>
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#6a82fb" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="8"/>
            <circle cx="9" cy="10" r="1"/>
            <circle cx="15" cy="10" r="1"/>
            <path d="M9 16c1.5-1 4.5-1 6 0"/>
          </svg>
        </button>
        <button class='img-toolbar-btn' title='一键换姿势'>
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#6a82fb" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="5" r="2"/>
            <path d="M12 7v4"/>
            <path d="M12 11l3 2"/>
            <path d="M12 11l-2 2"/>
            <path d="M12 7l-2 4"/>
            <path d="M12 17l2-4 4 2"/>
            <path d="M12 17l-2 2"/>
          </svg>
        </button>
      `;
      element.appendChild(toolbar);
      lastImgToolbar = toolbar;
      event.stopPropagation();

      // --- 新增：按钮弹出输入框并换图 ---
      const toolbarBtns = toolbar.querySelectorAll('.img-toolbar-btn');
      const placeholderArr = [
        '将图中的香水换成一瓶啤酒',
        '将衣服换成粉色运动短裙',
        '将面部形象换成中国女孩',
        '将画面中的女孩姿势换成 举起双手欢呼的姿势'
      ];
      const imgArr = [
        'img/shot1-change-product-beer.jpeg', // 一键换商品
        'img/shot1-change-color.jpeg',        // 一键换衣
        'img/shot1-change-face-chinese.jpeg', // 一键换脸
        'img/shot1-change-pose-arms open.jpeg'// 一键换姿势
      ];
      function showInput(idx) {
        // 先移除旧的输入框和进度条
        let oldInput = element.querySelector('#toolbar-action-input');
        if (oldInput) oldInput.remove();
        let oldBar = element.querySelector('#toolbar-progress-bar');
        if (oldBar) oldBar.remove();

        // 关键：让图片容器变为定位上下文，且不影响布局
        element.style.position = 'relative';
        element.style.overflow = 'visible';

        // 创建新输入框浮层
        const inputWrap = document.createElement('div');
        inputWrap.id = 'toolbar-action-input';
        inputWrap.className = 'toolbar-action-input';
        inputWrap.innerHTML = `
          <input class='replace-input' type='text' placeholder='${placeholderArr[idx]}' style='width:260px;'>
          <button class='replace-confirm'>确定</button>
        `;
        // 绝对定位到工具栏正下方
        inputWrap.style.position = 'absolute';
        inputWrap.style.left = '50%';
        const offsetTop = toolbar.offsetTop + toolbar.offsetHeight + 12;
        inputWrap.style.top = offsetTop + 'px';
        inputWrap.style.transform = 'translateX(-50%)';
        inputWrap.style.zIndex = '2000';
        inputWrap.style.background = '#fff';
        element.appendChild(inputWrap);

        // 事件：点击确定
        inputWrap.querySelector('.replace-confirm').onclick = function(ev) {
          ev.stopPropagation();
          inputWrap.remove();

          // 创建进度条浮层
          let progressBar = document.createElement('div');
          progressBar.id = 'toolbar-progress-bar';
          progressBar.className = 'replace-progress-bar';
          progressBar.style.position = 'absolute';
          progressBar.style.left = '50%';
          progressBar.style.top = '50%';
          progressBar.style.transform = 'translate(-50%,-50%)';
          progressBar.style.zIndex = '2000';
          progressBar.innerHTML = `<div class='replace-progress-inner'></div>`;
          element.appendChild(progressBar);

          setTimeout(()=>{
            progressBar.querySelector('.replace-progress-inner').style.width = '100%';
          }, 30);
          setTimeout(()=>{
            progressBar.remove();
            // 直接替换当前图片
            const img = element.querySelector('img');
            if(img) {
              img.src = imgArr[idx];
            }
          }, 1030);
        };
        // 回车也可确定
        inputWrap.querySelector('.replace-input').onkeydown = function(ev) {
          if(ev.key==='Enter') inputWrap.querySelector('.replace-confirm').click();
        };
        inputWrap.querySelector('.replace-input').focus();
      }
      toolbarBtns.forEach((btn, idx) => {
        btn.onclick = function(e) {
          e.stopPropagation();
          showInput(idx);
        };
      });
    }
    // 点击空白处关闭工具栏
    document.addEventListener('click', function(e){
      if(lastImgToolbar && !lastImgToolbar.contains(e.target)){
        lastImgToolbar.remove();
        lastImgToolbar = null;
      }
    });
    function submitImage() {
      alert('图像已提交！');
    }
    function submitUpload() {
      // 直接根据 currentShotIndex 获取镜头
      const shotThumbs = document.querySelectorAll('.shot-thumb');
      const selected = shotThumbs[currentShotIndex];
      if (!selected) { alert('请先选择一个镜头'); return; }
      // 只给当前选中的镜头加勾，不移除其他勾
      let check = selected.querySelector('.shot-check');
      if (!check) {
        check = document.createElement('span');
        check.className = 'shot-check';
        check.innerHTML = '✔';
        check.style.cssText = 'position:absolute;right:10px;top:10px;color:#22c55e;font-size:1.6em;font-weight:bold;background:rgba(255,255,255,0.8);border-radius:50%;padding:2px 8px;z-index:3;';
        selected.appendChild(check);
      }
    }
    function scrollClipShots(direction) {
      const totalShots = 7;
      if (direction === 'left') {
        clipShotScrollIndex = Math.max(0, clipShotScrollIndex - 1);
      } else {
        clipShotScrollIndex = Math.min(totalShots - 4, clipShotScrollIndex + 1);
      }
      document.getElementById('clipShotsInner').style.transform = `translateX(-${clipShotScrollIndex * 284}px)`;
    }
    function selectClipShot(element) {
      document.querySelectorAll('.clip-shot-thumb').forEach(e => e.style.boxShadow = 'none');
      element.style.boxShadow = '0 0 0 3px #6a82fb';
      const idx = parseInt(element.getAttribute('data-index'));
      currentClipShotIndex = idx;
      let refImg = `img/shot${idx+1}-1.jpeg`;
      if(idx === 2) refImg = 'img/shot3-2.jpeg';
      document.getElementById('clipRefImg').src = refImg;
      // 提示词逻辑：用shotPrompts数组内容
      const div = document.getElementById('clipPromptText');
      div.textContent = shotPrompts[idx] || '';
    }
    function generateClipVideos() {
      const progressBar = document.getElementById('clipProgressBar');
      const progressFill = document.getElementById('clipProgressFill');
      const generatedClips = document.getElementById('generatedClips');
      const clipGrid = document.getElementById('clipGrid');
      // 显示进度条和占位
      progressBar.style.display = 'block';
      progressFill.style.width = '0%';
      generatedClips.style.display = 'block';
      clipGrid.innerHTML = '';
      selectedClipIndex = null;
      for(let i=0;i<4;i++){
        clipGrid.innerHTML += `<div class='clip-video-thumb' data-clip='${i}' style='aspect-ratio:1.6;background:#e0e7ff;border-radius:12px;overflow:hidden;display:flex;align-items:center;justify-content:center;cursor:pointer;'></div>`;
      }
      setTimeout(() => {
        progressFill.style.width = '100%';
      }, 50);
      setTimeout(() => {
        clipGrid.innerHTML = '';
        const shotNum = currentClipShotIndex + 1;
        for(let i=1;i<=4;i++){
          clipGrid.innerHTML += `<div class='clip-video-thumb' data-clip='${i-1}' onclick='selectClipVideo(this)' style='aspect-ratio:1.6;background:#e0e7ff;border-radius:12px;overflow:hidden;display:flex;align-items:center;justify-content:center;cursor:pointer;'><video src='video/shot${shotNum}-${i}.mp4' controls style='width:100%;height:100%;border-radius:12px;background:#000;'></video></div>`;
        }
        progressBar.style.display = 'none';
      }, 2000);
    }
    function selectClipVideo(el) {
      document.querySelectorAll('.clip-video-thumb').forEach(e => e.style.boxShadow = 'none');
      el.style.boxShadow = '0 0 0 3px #6a82fb';
      selectedClipIndex = parseInt(el.getAttribute('data-clip'));
    }
    document.getElementById('clipSubmitBtn').onclick = function() {
      // 只要选了clip就给当前镜头打勾
      if(selectedClipIndex === null) { alert('请先选择一个Clip视频'); return; }
      const shotThumbs = document.querySelectorAll('.clip-shot-thumb');
      const selected = shotThumbs[currentClipShotIndex];
      if (!selected) { alert('请先选择一个镜头'); return; }
      let check = selected.querySelector('.shot-check');
      if (!check) {
        check = document.createElement('span');
        check.className = 'shot-check';
        check.innerHTML = '✔';
        check.style.cssText = 'position:absolute;right:10px;top:10px;color:#22c55e;font-size:1.6em;font-weight:bold;background:rgba(255,255,255,0.8);border-radius:50%;padding:2px 8px;z-index:3;';
        selected.appendChild(check);
      }
    }
  </script>
</body>
</html> 