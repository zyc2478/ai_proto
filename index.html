<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>Flixor.ai - Stylize Vide</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      background: linear-gradient(135deg, #6a82fb 0%, #fc5c7d 100%);
      color: #222;
      font-family: 'Segoe UI', Arial, sans-serif;
      margin: 0;
      min-height: 100vh;
    }
    .nav {
      background: rgba(255,255,255,0.95);
      border-bottom: 1px solid #e0e0e0;
      padding: 0 0 0 0;
      position: sticky;
      top: 0;
      z-index: 10;
      display: flex;
      align-items: center;
      height: 70px;
      box-shadow: 0 2px 12px 0 rgba(106,130,251,0.07);
    }
    .logo {
      font-size: 2.2rem;
      font-weight: bold;
      color: #6a82fb;
      letter-spacing: 2px;
      margin-left: 40px;
    }
    .subtitle {
      color: #888;
      font-size: 1.2rem;
      margin-left: 12px;
      font-weight: 500;
    }
    .nav a {
      color: #333;
      text-decoration: none;
      margin: 0 28px;
      font-weight: 500;
      font-size: 1.1rem;
      transition: color 0.2s;
      padding: 8px 0;
      border-bottom: 2px solid transparent;
    }
    .nav a.active, .nav a:hover {
      color: #6a82fb;
      border-bottom: 2px solid #6a82fb;
    }
    .section {
      max-width: 1200px;
      margin: 48px auto 0 auto;
      background: rgba(255,255,255,0.98);
      border-radius: 18px;
      box-shadow: 0 8px 32px 0 rgba(106,130,251,0.10);
      padding: 48px 56px 56px 56px;
      min-height: 600px;
    }
    .banner {
      background: linear-gradient(90deg, #6a82fb 0%, #fc5c7d 100%);
      padding: 60px 0 40px 0;
      text-align: center;
      border-radius: 16px;
      color: #fff;
      margin-bottom: 40px;
      box-shadow: 0 4px 24px 0 rgba(106,130,251,0.10);
    }
    .banner h1 {
      font-size: 2.6rem;
      font-weight: 700;
      margin-bottom: 18px;
      letter-spacing: 1px;
    }
    .main-btn, .import-btn, .gen-btn, .add-btn, .compose-btn {
      background: #6a82fb;
      color: #fff;
      border: none;
      padding: 10px 26px;
      border-radius: 8px;
      cursor: pointer;
      margin-left: 8px;
      font-size: 1rem;
      font-weight: 500;
      box-shadow: 0 2px 8px 0 rgba(106,130,251,0.10);
      transition: background 0.2s, box-shadow 0.2s;
    }
    .main-btn {
      padding: 18px 60px;
      font-size: 1.4rem;
      border-radius: 12px;
      margin: 32px 0;
      font-weight: 600;
    }
    .main-btn:hover, .import-btn:hover, .gen-btn:hover, .add-btn:hover, .compose-btn:hover {
      background: #5a6eea;
      box-shadow: 0 4px 16px 0 rgba(106,130,251,0.18);
    }
    .info-stream {
      display: flex;
      flex-wrap: wrap;
      gap: 32px;
      justify-content: center;
      margin: 40px 0;
    }
    .info-card {
      background: linear-gradient(135deg, #e0e7ff 0%, #f3e7e9 100%);
      border-radius: 16px;
      box-shadow: 0 2px 12px 0 rgba(106,130,251,0.08);
      width: 340px;
      padding: 32px 24px;
      transition: transform 0.2s, box-shadow 0.2s;
      border: 1px solid #e0e0e0;
    }
    .info-card:hover {
      transform: translateY(-6px) scale(1.03);
      box-shadow: 0 8px 32px 0 rgba(106,130,251,0.18);
    }
    .info-card h3 {
      color: #6a82fb;
      font-size: 1.3rem;
      margin-bottom: 10px;
    }
    .input-row {
      margin-bottom: 28px;
    }
    .input-row label {
      display: block;
      margin-bottom: 8px;
      color: #6a82fb;
      font-weight: 500;
      font-size: 1.08rem;
    }
    .input-row input, .input-row textarea, .input-row select {
      width: 100%;
      padding: 13px 14px;
      border: 1.5px solid #d1d5db;
      border-radius: 8px;
      font-size: 1.08rem;
      background: #f7f8fa;
      transition: border 0.2s;
      margin-bottom: 4px;
    }
    .input-row input:focus, .input-row textarea:focus, .input-row select:focus {
      border: 1.5px solid #6a82fb;
      outline: none;
    }
    .material-list, .scene-list, .clip-list, .plot-list {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      margin: 16px 0;
    }
    .material-item, .scene-item, .clip-item, .plot-item {
      background: linear-gradient(135deg, #e0e7ff 0%, #f3e7e9 100%);
      border-radius: 10px;
      padding: 18px 20px;
      min-width: 120px;
      text-align: center;
      font-size: 1.08rem;
      color: #333;
      box-shadow: 0 2px 8px 0 rgba(106,130,251,0.07);
      border: 1px solid #e0e0e0;
    }
    .storyboard-section {
      margin-bottom: 36px;
    }
    .storyboard-img {
      width: 140px;
      height: 90px;
      background: linear-gradient(135deg, #e0e7ff 0%, #f3e7e9 100%);
      border-radius: 8px;
      display: inline-block;
      margin-right: 16px;
      box-shadow: 0 2px 8px 0 rgba(106,130,251,0.07);
      border: 1px solid #e0e0e0;
    }
    .effect-select {
      margin-top: 18px;
    }
    .compose-btn {
      margin-top: 18px;
      padding: 14px 40px;
      font-size: 1.15rem;
    }
    @media (max-width: 900px) {
      .section { padding: 24px 8vw; }
      .info-stream { flex-direction: column; align-items: center; }
    }
    @media (max-width: 600px) {
      .section { padding: 12px 2vw; min-height: 400px; }
      .banner h1 { font-size: 1.3rem; }
      .main-btn { padding: 12px 20px; font-size: 1rem; }
      .info-card { width: 90vw; padding: 18px 8px; }
    }
    .nav svg.icon {
      width: 1.3em;
      height: 1.3em;
      vertical-align: middle;
      margin-right: 6px;
      fill: #6a82fb;
      display: inline-block;
    }
    .video-masonry {
      column-count: 4;
      column-gap: 32px;
      width: 100%;
      max-height: 800px;
      overflow-y: auto;
      overflow-x: hidden;
      margin-bottom: 24px;
    }
    .video-card {
      background: #e0e7ff;
      border-radius: 16px;
      box-shadow: 0 2px 12px 0 rgba(106,130,251,0.08);
      margin-bottom: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
      color: #b3b8d0;
      break-inside: avoid;
      width: 100%;
    }
    @media (max-width: 1200px) {
      .video-masonry { column-count: 2; }
    }
    @media (max-width: 700px) {
      .video-masonry { column-count: 1; }
    }
    .img-toolbar {
      position: absolute;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      display: flex;
      gap: 18px;
      background: rgba(255,255,255,0.95);
      border-radius: 32px;
      box-shadow: 0 4px 16px rgba(106,130,251,0.10);
      padding: 8px 20px;
      z-index: 10;
      align-items: center;
    }
    .img-toolbar-btn {
      background: none;
      border: none;
      outline: none;
      border-radius: 50%;
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.18s, box-shadow 0.18s;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(106,130,251,0.08);
    }
    .img-toolbar-btn:hover {
      background: #e0e7ff;
      box-shadow: 0 4px 16px rgba(106,130,251,0.18);
    }
    .img-toolbar-btn svg {
      display: block;
    }
    .replace-popover {
      display: flex;
      align-items: center;
      gap: 8px;
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 2px 12px rgba(106,130,251,0.13);
      padding: 6px 14px;
      border: 1.5px solid #e0e7ff;
      font-size: 15px;
    }
    .replace-input {
      border: 1px solid #d1d5db;
      border-radius: 8px;
      padding: 4px 8px;
      font-size: 15px;
      outline: none;
      transition: border 0.18s;
    }
    .replace-input:focus {
      border: 1.5px solid #6a82fb;
    }
    .replace-confirm {
      background: linear-gradient(90deg,#6a82fb,#fc5c7d);
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 4px 14px;
      font-size: 15px;
      cursor: pointer;
      transition: background 0.18s;
    }
    .replace-confirm:hover {
      background: linear-gradient(90deg,#fc5c7d,#6a82fb);
    }
    .replace-progress-bar {
      position: absolute;
      left: 50%;
      top: 18px;
      transform: translateX(-50%);
      width: 60%;
      height: 8px;
      background: #e0e7ff;
      border-radius: 8px;
      overflow: hidden;
      z-index: 20;
      box-shadow: 0 2px 8px rgba(106,130,251,0.10);
    }
    .replace-progress-inner {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg,#6a82fb,#fc5c7d);
      border-radius: 8px;
      transition: width 2s cubic-bezier(.4,1,.6,1);
    }
  </style>
</head>
<body>

<!-- 顶部导航 -->
<div class="nav">
  <span class="logo" style="position:relative;display:inline-flex;align-items:baseline;">
    Flixor
    <span class="subtitle" style="margin-left:8px;font-size:0.9rem;color:#b3b8d0;font-weight:400;line-height:1;">Stylized Video</span>
  </span>
  <a href="#home" class="active"><svg class="icon" viewBox="0 0 24 24"><path d="M3 10.5L12 4l9 6.5V20a1 1 0 0 1-1 1h-5v-5h-6v5H4a1 1 0 0 1-1-1V10.5z"/></svg>Home</a>
  <span style="margin:0 18px;color:#d1d5db;">|</span>
  <a href="#brief">Story</a>
  <span style="margin:0 18px;color:#d1d5db;">|</span>
  <a href="#storyboard">StoryBoard</a>
  <span style="margin:0 18px;color:#d1d5db;">|</span>
  <a href="#material">Image</a>
  <span style="margin:0 18px;color:#d1d5db;">|</span>
  <a href="#clip">Clip</a>
  <span style="margin:0 18px;color:#d1d5db;">|</span>
  <a href="#compose">Video</a>
</div>

<!-- 页面1：主页 -->
<div id="home" class="section">
  <div class="banner">
    <h1>释放你的创意，AI驱动视频创作</h1>
    <button class="main-btn" onclick="showPage('brief')">立即创作</button>
  </div>
  <div class="info-row" style="display:flex;gap:32px;justify-content:space-between;margin:40px 0 48px 0;">
    <div class="info-card" style="flex:1;min-width:200px;max-width:280px;display:flex;flex-direction:column;align-items:center;justify-content:center;">
      <h3 style="color:#6a82fb;font-size:1.25rem;font-weight:700;margin-bottom:12px;">AI素材</h3>
      <div style="font-size:1.05rem;text-align:center;margin-bottom:8px;">为品牌生成AI 5s的短片镜头</div>
    </div>
    <div class="info-card" style="flex:1;min-width:200px;max-width:280px;display:flex;flex-direction:column;align-items:center;justify-content:center;">
      <h3 style="color:#6a82fb;font-size:1.25rem;font-weight:700;margin-bottom:12px;">品牌宣传片</h3>
      <div style="font-size:1.05rem;text-align:center;margin-bottom:8px;">为品牌生成风格化的tvc视频</div>
    </div>
    <div class="info-card" style="flex:1;min-width:200px;max-width:280px;display:flex;flex-direction:column;align-items:center;justify-content:center;">
      <h3 style="color:#6a82fb;font-size:1.25rem;font-weight:700;margin-bottom:12px;">种草视频</h3>
      <div style="font-size:1.05rem;text-align:center;margin-bottom:8px;">为品牌生成AI种草类视频</div>
    </div>
    <div class="info-card" style="flex:1;min-width:200px;max-width:280px;display:flex;flex-direction:column;align-items:center;justify-content:center;">
      <h3 style="color:#6a82fb;font-size:1.25rem;font-weight:700;margin-bottom:12px;">产品介绍</h3>
      <div style="font-size:1.05rem;text-align:center;margin-bottom:8px;">为品牌生成产品介绍视频</div>
    </div>
  </div>
  <div class="video-masonry">
    <div class="video-card" style="height:180px;">视频封面1</div>
    <div class="video-card" style="height:260px;">视频封面2</div>
    <div class="video-card" style="height:210px;">视频封面3</div>
    <div class="video-card" style="height:320px;">视频封面4</div>
    <div class="video-card" style="height:200px;">视频封面5</div>
    <div class="video-card" style="height:280px;">视频封面6</div>
    <div class="video-card" style="height:170px;">视频封面7</div>
    <div class="video-card" style="height:230px;">视频封面8</div>
    <div class="video-card" style="height:190px;">视频封面9</div>
    <div class="video-card" style="height:250px;">视频封面10</div>
    <div class="video-card" style="height:220px;">视频封面11</div>
    <div class="video-card" style="height:300px;">视频封面12</div>
    <div class="video-card" style="height:210px;">视频封面13</div>
    <div class="video-card" style="height:270px;">视频封面14</div>
    <div class="video-card" style="height:160px;">视频封面15</div>
    <div class="video-card" style="height:240px;">视频封面16</div>
    <div class="video-card" style="height:200px;">视频封面17</div>
    <div class="video-card" style="height:260px;">视频封面18</div>
    <div class="video-card" style="height:180px;">视频封面19</div>
    <div class="video-card" style="height:220px;">视频封面20</div>
  </div>
</div>

<!-- 页面2：Brief页面 -->
<div id="brief" class="section" style="display:none;">
  <div style="display:flex;justify-content:space-between;align-items:center;">
    <h2>生成Story</h2>
    <button class="import-btn">导入Story</button>
  </div>
  <div class="input-row">
    <label>品牌名称</label>
    <input type="text" placeholder="请输入品牌名称">
  </div>
  <div class="input-row">
    <label>产品名称</label>
    <input type="text" placeholder="请输入产品名称">
  </div>
  <div class="input-row">
    <label>主题</label>
    <input type="text" placeholder="请输入视频主题">
    <button class="import-btn">生成主题</button>
  </div>
  <div class="input-row">
    <label>参考链接
      <span style="display:inline-block;cursor:pointer;color:#b3b8d0;font-weight:bold;font-size:0.95em;" title="品牌官方的电商店铺链接，比如京东、淘宝、天猫等官方链接">？</span>
    </label>
    <input type="text" placeholder="请输入参考链接">
  </div>
  <div class="input-row">
    <label>Brief Story</label>
    <textarea rows="3" placeholder="自动生成或导入Brief Story"></textarea>
    <button class="gen-btn">生成 Story</button>
  </div>
  <button class="main-btn" onclick="showPage('storyboard')">下一步：生成StoryBoard</button>
</div>

<!-- 页面3：选择/生成图像 -->
<div id="material" class="section" style="display:none;">
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:32px;">
    <div style="font-size:24px;font-weight:600;">选择/生成图像</div>
    <button onclick="showPage('storyboard')" style="padding:8px 16px;background:#6a82fb;color:white;border:none;border-radius:8px;cursor:pointer;font-weight:500;">返回</button>
  </div>
  <div style="position:relative;margin-bottom:32px;display:flex;justify-content:center;">
    <button onclick="scrollShots('left')" style="position:absolute;left:0;top:50%;transform:translateY(-50%);background:#6a82fb;color:white;border:none;border-radius:50%;width:40px;height:40px;cursor:pointer;font-size:22px;z-index:2;">&lt;</button>
    <div id="shotsContainer" style="width:1104px;max-width:100vw;overflow:hidden;position:relative;padding:16px 0;">
      <div id="shotsInner" style="display:flex;gap:24px;transition:transform 0.3s;will-change:transform;">
        <div class="shot-thumb" data-index="0" onclick="selectShot(this)" style="width:260px;height:180px;background:#e0e7ff;border-radius:16px;cursor:pointer;display:flex;align-items:flex-start;justify-content:flex-start;position:relative;">
          <img src="img/1-1.jpeg" style="width:100%;height:100%;object-fit:cover;border-radius:16px;">
          <span style="position:absolute;left:14px;top:14px;color:#333;font-weight:500;background:rgba(255,255,255,0.7);border-radius:8px;padding:2px 12px;">镜头1</span>
        </div>
        <div class="shot-thumb" data-index="1" onclick="selectShot(this)" style="width:260px;height:180px;background:#e0e7ff;border-radius:16px;cursor:pointer;display:flex;align-items:flex-start;justify-content:flex-start;position:relative;">
          <img src="img/2-1.jpeg" style="width:100%;height:100%;object-fit:cover;border-radius:16px;">
          <span style="position:absolute;left:14px;top:14px;color:#333;font-weight:500;background:rgba(255,255,255,0.7);border-radius:8px;padding:2px 12px;">镜头2</span>
        </div>
        <div class="shot-thumb" data-index="2" onclick="selectShot(this)" style="width:260px;height:180px;background:#e0e7ff;border-radius:16px;cursor:pointer;display:flex;align-items:flex-start;justify-content:flex-start;position:relative;">
          <img src="img/3-1.jpeg" style="width:100%;height:100%;object-fit:cover;border-radius:16px;">
          <span style="position:absolute;left:14px;top:14px;color:#333;font-weight:500;background:rgba(255,255,255,0.7);border-radius:8px;padding:2px 12px;">镜头3</span>
        </div>
        <div class="shot-thumb" data-index="3" onclick="selectShot(this)" style="width:260px;height:180px;background:#e0e7ff;border-radius:16px;cursor:pointer;display:flex;align-items:flex-start;justify-content:flex-start;position:relative;">
          <img src="img/4-1.jpeg" style="width:100%;height:100%;object-fit:cover;border-radius:16px;">
          <span style="position:absolute;left:14px;top:14px;color:#333;font-weight:500;background:rgba(255,255,255,0.7);border-radius:8px;padding:2px 12px;">镜头4</span>
        </div>
        <div class="shot-thumb" data-index="4" onclick="selectShot(this)" style="width:260px;height:180px;background:#e0e7ff;border-radius:16px;cursor:pointer;display:flex;align-items:flex-start;justify-content:flex-start;position:relative;">
          <img src="img/5-1.jpeg" style="width:100%;height:100%;object-fit:cover;border-radius:16px;">
          <span style="position:absolute;left:14px;top:14px;color:#333;font-weight:500;background:rgba(255,255,255,0.7);border-radius:8px;padding:2px 12px;">镜头5</span>
        </div>
        <div class="shot-thumb" data-index="5" onclick="selectShot(this)" style="width:260px;height:180px;background:#e0e7ff;border-radius:16px;cursor:pointer;display:flex;align-items:flex-start;justify-content:flex-start;position:relative;">
          <img src="img/6-1.jpeg" style="width:100%;height:100%;object-fit:cover;border-radius:16px;">
          <span style="position:absolute;left:14px;top:14px;color:#333;font-weight:500;background:rgba(255,255,255,0.7);border-radius:8px;padding:2px 12px;">镜头6</span>
        </div>
        <div class="shot-thumb" data-index="6" onclick="selectShot(this)" style="width:260px;height:180px;background:#e0e7ff;border-radius:16px;cursor:pointer;display:flex;align-items:flex-start;justify-content:flex-start;position:relative;">
          <img src="img/7-1.jpeg" style="width:100%;height:100%;object-fit:cover;border-radius:16px;">
          <span style="position:absolute;left:14px;top:14px;color:#333;font-weight:500;background:rgba(255,255,255,0.7);border-radius:8px;padding:2px 12px;">镜头7</span>
        </div>
      </div>
    </div>
    <button onclick="scrollShots('right')" style="position:absolute;right:0;top:50%;transform:translateY(-50%);background:#6a82fb;color:white;border:none;border-radius:50%;width:40px;height:40px;cursor:pointer;font-size:22px;z-index:2;">&gt;</button>
  </div>
  <div style="margin-bottom:32px;">
    <div style="font-weight:600;margin-bottom:16px;">生图提示词</div>
    <textarea id="promptText" style="width:100%;height:120px;padding:12px;border:1px solid #e5e7eb;border-radius:8px;resize:none;font-family:inherit;" placeholder="选择镜头后，这里会显示对应的文字描述..."></textarea>
  </div>
  <div style="margin-bottom:32px;">
    <button id="generateBtn" style="width:100%;padding:12px;background:#6a82fb;color:white;border:none;border-radius:8px;cursor:pointer;font-weight:500;" onclick="generateImages()">生成图像</button>
    <button id="uploadBtn" style="width:100%;padding:12px;background:#f3f4f6;color:#6a82fb;border:none;border-radius:8px;cursor:pointer;font-weight:500;margin-top:12px;">上传图像</button>
    <button id="uploadSubmitBtn" style="width:100%;padding:12px;background:#6a82fb;color:white;border:none;border-radius:8px;cursor:pointer;font-weight:500;margin-top:12px;" onclick="submitUpload()">提交</button>
    <div id="progressBar" style="width:100%;height:4px;background:#e0e7ff;border-radius:2px;margin-top:16px;display:none;">
      <div id="progressFill" style="width:0%;height:100%;background:#6a82fb;border-radius:2px;transition:width 2s;"></div>
    </div>
  </div>
  <div id="generatedImages" style="display:none;margin-bottom:32px;">
    <div style="font-weight:600;margin-bottom:16px;">生成的图像</div>
    <div id="genImgGrid" style="display:grid;grid-template-columns:repeat(2,1fr);gap:16px;">
      <!-- 这里动态填充图片或占位框 -->
    </div>
  </div>
  <script>
    // 全局变量声明
    let lastImgToolbar = null;
    let shotScrollIndex = 0;
    let currentShotIndex = 0;
    let submittedShots = Array(7).fill(false);
    let clipShotScrollIndex = 0;
    let currentClipShotIndex = 0;
    let selectedClipIndex = null;

    // 全局函数定义
    function showPage(page) {
      console.log('Switching to page:', page);
      
      // 隐藏所有页面
      ['home', 'brief', 'material', 'storyboard', 'clip', 'compose'].forEach(function(id) {
        const element = document.getElementById(id);
        if (element) {
          if (id === page) {
            element.style.display = 'block';
            console.log('Showing element:', id);
          } else {
            element.style.display = 'none';
            console.log('Hiding element:', id);
          }
        } else {
          console.log('Element not found:', id);
        }
      });
      
      // 更新导航高亮
      document.querySelectorAll('.nav a').forEach(function(a) {
        const isActive = a.getAttribute('href') === '#' + page;
        a.classList.toggle('active', isActive);
        console.log('Nav link:', a.getAttribute('href'), 'active:', isActive);
      });
    }

    // 页面初始化
    document.addEventListener('DOMContentLoaded', function() {
      // 导航点击切换
      document.querySelectorAll('.nav a').forEach(function(a) {
        a.addEventListener('click', function(e) {
          e.preventDefault();
          const page = a.getAttribute('href').replace('#', '');
          console.log('Nav clicked:', page);
          showPage(page);
        });
      });

      // 页面加载时根据hash显示对应页面
      const hash = location.hash.replace('#', '') || 'home';
      console.log('Initial hash:', hash);
      showPage(hash);

      // hash变化时切换页面
      window.addEventListener('hashchange', function() {
        const hash = location.hash.replace('#', '') || 'home';
        console.log('Hash changed:', hash);
        showPage(hash);
      });

      // 初始化默认选中镜头1
      selectClipShot(document.querySelector('.clip-shot-thumb[data-index="0"]'));
    });

    function generateImages() {
      const progressBar = document.getElementById('progressBar');
      const progressFill = document.getElementById('progressFill');
      const generatedImages = document.getElementById('generatedImages');
      const genImgGrid = document.getElementById('genImgGrid');
      progressBar.style.display = 'block';
      progressFill.style.width = '0%';
      generatedImages.style.display = 'block';
      genImgGrid.innerHTML = '';
      for(let i=0;i<4;i++){
        genImgGrid.innerHTML += `<div style='aspect-ratio:1;background:#e0e7ff;border-radius:12px;position:relative;overflow:hidden;cursor:pointer;' onclick='selectGeneratedImage(this, event)'></div>`;
      }
      setTimeout(() => {
        progressFill.style.width = '100%';
      }, 50);
      setTimeout(() => {
        genImgGrid.innerHTML = '';
        const shotNum = currentShotIndex + 1;
        for(let i=1;i<=4;i++){
          genImgGrid.innerHTML += `<div style='aspect-ratio:1;background:#e0e7ff;border-radius:12px;overflow:hidden;position:relative;cursor:pointer;' onclick='selectGeneratedImage(this, event)'><img src='img/shot${shotNum}-${i}.jpeg' style='width:100%;height:100%;object-fit:cover;border-radius:12px;'></div>`;
        }
        progressBar.style.display = 'none';
      }, 2000);
    }
    function scrollShots(direction) {
      const maxIndex = 3;
      const totalShots = 7;
      if (direction === 'left') {
        shotScrollIndex = Math.max(0, shotScrollIndex - 1);
      } else {
        shotScrollIndex = Math.min(totalShots - 4, shotScrollIndex + 1);
      }
      document.getElementById('shotsInner').style.transform = `translateX(-${shotScrollIndex * 284}px)`;
    }
    function selectShot(element) {
      // 选中高亮
      document.querySelectorAll('.shot-thumb').forEach(e => e.style.boxShadow = 'none');
      element.style.boxShadow = '0 0 0 3px #6a82fb';
      // 获取索引并显示提示词
      const idx = parseInt(element.getAttribute('data-index'));
      currentShotIndex = idx;
      document.getElementById('promptText').value = shotPrompts[idx] || '';
    }
    function generateImages() {
      const progressBar = document.getElementById('progressBar');
      const progressFill = document.getElementById('progressFill');
      const generatedImages = document.getElementById('generatedImages');
      const genImgGrid = document.getElementById('genImgGrid');
      progressBar.style.display = 'block';
      progressFill.style.width = '0%';
      generatedImages.style.display = 'block';
      genImgGrid.innerHTML = '';
      for(let i=0;i<4;i++){
        genImgGrid.innerHTML += `<div style='aspect-ratio:1;background:#e0e7ff;border-radius:12px;position:relative;overflow:hidden;cursor:pointer;' onclick='selectGeneratedImage(this, event)'></div>`;
      }
      setTimeout(() => {
        progressFill.style.width = '100%';
      }, 50);
      setTimeout(() => {
        genImgGrid.innerHTML = '';
        const shotNum = currentShotIndex + 1;
        for(let i=1;i<=4;i++){
          genImgGrid.innerHTML += `<div style='aspect-ratio:1;background:#e0e7ff;border-radius:12px;overflow:hidden;position:relative;cursor:pointer;' onclick='selectGeneratedImage(this, event)'><img src='img/shot${shotNum}-${i}.jpeg' style='width:100%;height:100%;object-fit:cover;border-radius:12px;'></div>`;
        }
        progressBar.style.display = 'none';
      }, 2000);
    }
    // 删除重复的lastImgToolbar声明
    function selectGeneratedImage(element, event) {
      // 移除上一个工具栏
      if(lastImgToolbar) lastImgToolbar.remove();
      // 工具栏HTML（美化+新SVG图标）
      const toolbar = document.createElement('div');
      toolbar.className = 'img-toolbar';
      toolbar.innerHTML = `
        <button class='img-toolbar-btn' title='一键高清'>
          <svg width='22' height='22' viewBox='0 0 24 24' fill='none' stroke='#6a82fb' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><path d='M12 3v2M12 19v2M21 12h-2M5 12H3M17.657 6.343l-1.414 1.414M6.343 17.657l-1.414 1.414M17.657 17.657l-1.414-1.414M6.343 6.343L4.929 4.929M12 8a4 4 0 1 1 0 8a4 4 0 0 1 0-8z'/></svg>
        </button>
        <button class='img-toolbar-btn' title='一键换物' id='replace-item-btn'>
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#6a82fb" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="17 1 21 5 17 9"/><path d="M3 11V9a4 4 0 0 1 4-4h14"/><polyline points="7 23 3 19 7 15"/><path d="M21 13v2a4 4 0 0 1-4 4H3"/></svg>
        </button>
        <button class='img-toolbar-btn' title='一键换装'>
          <svg width='22' height='22' viewBox='0 0 24 24' fill='none' stroke='#6a82fb' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><path d='M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2'/><circle cx='12' cy='7' r='4'/></svg>
        </button>
      `;
      element.appendChild(toolbar);
      lastImgToolbar = toolbar;
      event.stopPropagation();

      // 一键换物按钮弹出浮层逻辑（浮层插入body并定位）
      const replaceBtn = toolbar.querySelector('#replace-item-btn');
      replaceBtn.onclick = function(e) {
        e.stopPropagation();
        // 若已存在浮层先移除
        const oldPopover = document.getElementById('replace-popover');
        if(oldPopover) oldPopover.remove();
        // 创建浮层
        const popover = document.createElement('div');
        popover.id = 'replace-popover';
        popover.className = 'replace-popover';
        popover.innerHTML = `
          <input class='replace-input' type='text' placeholder='请输入新物品，如"足球"' style='width:120px;'>
          <button class='replace-confirm'>确认</button>
        `;
        document.body.appendChild(popover);
        // 定位到图片上方中央
        const rect = element.getBoundingClientRect();
        const popoverRect = {width: 180, height: 36}; // 估算宽高
        popover.style.position = 'fixed';
        popover.style.left = (rect.left + rect.width/2 - popoverRect.width/2) + 'px';
        popover.style.top = (rect.top - popoverRect.height - 12) + 'px';
        popover.style.zIndex = '9999';

        // 点击浮层外自动关闭
        function handleDocClick(ev) {
          if (!popover.contains(ev.target)) {
            popover.remove();
            document.removeEventListener('mousedown', handleDocClick, true);
          }
        }
        setTimeout(()=>{
          document.addEventListener('mousedown', handleDocClick, true);
        }, 10);

        // 事件：确认关闭
        popover.querySelector('.replace-confirm').onclick = function(ev) {
          ev.stopPropagation();
          popover.remove();
          document.removeEventListener('mousedown', handleDocClick, true);
          // 仅对第一张图片做进度条和替换
          const img = element.querySelector('img');
          const isFirst = img && img.src && /shot1-1\.jpeg/.test(img.src);
          if(isFirst) {
            // 创建进度条
            let progressBar = element.querySelector('.replace-progress-bar');
            if(progressBar) progressBar.remove();
            progressBar = document.createElement('div');
            progressBar.className = 'replace-progress-bar';
            progressBar.innerHTML = `<div class='replace-progress-inner'></div>`;
            element.appendChild(progressBar);
            // 动画
            setTimeout(()=>{
              progressBar.querySelector('.replace-progress-inner').style.width = '100%';
            }, 30);
            setTimeout(()=>{
              progressBar.remove();
              img.src = 'img/shot1-change-beer.jpeg';
            }, 2030);
          }
        };
        // 回车也可确认
        popover.querySelector('.replace-input').onkeydown = function(ev) {
          if(ev.key==='Enter') {
            popover.querySelector('.replace-confirm').click();
          }
        };
        // 自动聚焦
        popover.querySelector('.replace-input').focus();
      };
    }
    // 点击空白处关闭工具栏
    document.addEventListener('click', function(e){
      if(lastImgToolbar && !lastImgToolbar.contains(e.target)){
        lastImgToolbar.remove();
        lastImgToolbar = null;
      }
    });
    function submitImage() {
      alert('图像已提交！');
    }
    function submitUpload() {
      // 直接根据 currentShotIndex 获取镜头
      const shotThumbs = document.querySelectorAll('.shot-thumb');
      const selected = shotThumbs[currentShotIndex];
      if (!selected) { alert('请先选择一个镜头'); return; }
      // 只给当前选中的镜头加勾，不移除其他勾
      let check = selected.querySelector('.shot-check');
      if (!check) {
        check = document.createElement('span');
        check.className = 'shot-check';
        check.innerHTML = '✔';
        check.style.cssText = 'position:absolute;right:10px;top:10px;color:#22c55e;font-size:1.6em;font-weight:bold;background:rgba(255,255,255,0.8);border-radius:50%;padding:2px 8px;z-index:3;';
        selected.appendChild(check);
      }
    }
    function scrollClipShots(direction) {
      const totalShots = 7;
      if (direction === 'left') {
        clipShotScrollIndex = Math.max(0, clipShotScrollIndex - 1);
      } else {
        clipShotScrollIndex = Math.min(totalShots - 4, clipShotScrollIndex + 1);
      }
      document.getElementById('clipShotsInner').style.transform = `translateX(-${clipShotScrollIndex * 284}px)`;
    }
    function selectClipShot(element) {
      document.querySelectorAll('.clip-shot-thumb').forEach(e => e.style.boxShadow = 'none');
      element.style.boxShadow = '0 0 0 3px #6a82fb';
      const idx = parseInt(element.getAttribute('data-index'));
      currentClipShotIndex = idx;
      let refImg = `img/shot${idx+1}-1.jpeg`;
      if(idx === 2) refImg = 'img/shot3-2.jpeg';
      document.getElementById('clipRefImg').src = refImg;
      // 提示词逻辑：用shotPrompts数组内容
      const div = document.getElementById('clipPromptText');
      div.textContent = shotPrompts[idx] || '';
    }
    function generateClipVideos() {
      const progressBar = document.getElementById('clipProgressBar');
      const progressFill = document.getElementById('clipProgressFill');
      const generatedClips = document.getElementById('generatedClips');
      const clipGrid = document.getElementById('clipGrid');
      // 显示进度条和占位
      progressBar.style.display = 'block';
      progressFill.style.width = '0%';
      generatedClips.style.display = 'block';
      clipGrid.innerHTML = '';
      selectedClipIndex = null;
      for(let i=0;i<4;i++){
        clipGrid.innerHTML += `<div class='clip-video-thumb' data-clip='${i}' style='aspect-ratio:1.6;background:#e0e7ff;border-radius:12px;overflow:hidden;display:flex;align-items:center;justify-content:center;cursor:pointer;'></div>`;
      }
      setTimeout(() => {
        progressFill.style.width = '100%';
      }, 50);
      setTimeout(() => {
        clipGrid.innerHTML = '';
        const shotNum = currentClipShotIndex + 1;
        for(let i=1;i<=4;i++){
          clipGrid.innerHTML += `<div class='clip-video-thumb' data-clip='${i-1}' onclick='selectClipVideo(this)' style='aspect-ratio:1.6;background:#e0e7ff;border-radius:12px;overflow:hidden;display:flex;align-items:center;justify-content:center;cursor:pointer;'><video src='video/shot${shotNum}-${i}.mp4' controls style='width:100%;height:100%;border-radius:12px;background:#000;'></video></div>`;
        }
        progressBar.style.display = 'none';
      }, 2000);
    }
    function selectClipVideo(el) {
      document.querySelectorAll('.clip-video-thumb').forEach(e => e.style.boxShadow = 'none');
      el.style.boxShadow = '0 0 0 3px #6a82fb';
      selectedClipIndex = parseInt(el.getAttribute('data-clip'));
    }
    document.getElementById('clipSubmitBtn').onclick = function() {
      // 只要选了clip就给当前镜头打勾
      if(selectedClipIndex === null) { alert('请先选择一个Clip视频'); return; }
      const shotThumbs = document.querySelectorAll('.clip-shot-thumb');
      const selected = shotThumbs[currentClipShotIndex];
      if (!selected) { alert('请先选择一个镜头'); return; }
      let check = selected.querySelector('.shot-check');
      if (!check) {
        check = document.createElement('span');
        check.className = 'shot-check';
        check.innerHTML = '✔';
        check.style.cssText = 'position:absolute;right:10px;top:10px;color:#22c55e;font-size:1.6em;font-weight:bold;background:rgba(255,255,255,0.8);border-radius:50%;padding:2px 8px;z-index:3;';
        selected.appendChild(check);
      }
    }
  </script>
  <div style="display:flex;justify-content:flex-end;gap:16px;margin-top:32px;">
    <button onclick="showPage('storyboard')" style="padding:12px 24px;background:#f3f4f6;border:none;border-radius:8px;cursor:pointer;font-weight:500;">返回</button>
    <button id="submitBtn" style="padding:12px 24px;background:#6a82fb;color:white;border:none;border-radius:8px;cursor:pointer;font-weight:500;display:none;" onclick="submitImage()">提交</button>
  </div>
</div>

<!-- 页面4：生成StoryBoard -->
<div id="storyboard" class="section" style="display:none;">
  <div style="display:flex;justify-content:space-between;align-items:center;">
    <h2>生成StoryBoard</h2>
    <button class="import-btn" onclick="importStoryboard()">导入StoryBoard</button>
  </div>
  <div class="input-row">
    <label>品牌Story</label>
    <textarea id="brandStory" rows="6" style="font-size:1.08rem;width:100%;">2026世界杯期间，时尚女孩身着潮流衣装，在赛场边精心喷上雅诗兰黛香水，那迷人芬芳瞬间飘散。赛后她走进赛场周边咖啡馆休息，活力男孩也因对足球的热爱踏入这里。女孩身上雅诗兰黛香水的独特气息吸引了男孩，两人因足球话题相谈甚欢。香水的芬芳在空气中弥漫，仿佛为这段相遇增添了浪漫滤镜。此后，他们的爱情如世界杯的热情般炽热甜蜜，雅诗兰黛香水见证了这段美好缘分。</textarea>
    <button class="gen-btn" onclick="generateStoryboard()">生成StoryBoard</button>
  </div>
  <div id="storyboardProgress" style="display:none;margin:32px 0;">
    <div style="width:100%;background:#f0f0f0;border-radius:8px;overflow:hidden;">
      <div id="progressBar" style="width:0%;height:16px;background:linear-gradient(90deg,#6a82fb,#fc5c7d);transition:width 0.5s;"></div>
    </div>
    <div style="margin-top:8px;color:#6a82fb;">正在生成StoryBoard...</div>
  </div>
  <div id="storyboardResult" style="display:none;">
    <div style="font-weight:600;margin:32px 0 8px 0;">故事场景</div>
    <div style="display:flex;gap:18px;margin-bottom:8px;width:100%;">
      <div style="flex:1;display:flex;flex-direction:column;align-items:center;">
        <img src="img/场景1.jpeg" style="width:100%;height:120px;object-fit:cover;border-radius:12px;background:#e0e7ff;cursor:pointer;" onclick="showImgPreview(this)">
        <div style="margin-top:6px;color:#6a82fb;font-weight:500;">场景1</div>
      </div>
      <div style="flex:1;display:flex;flex-direction:column;align-items:center;">
        <img src="img/场景2.jpeg" style="width:100%;height:120px;object-fit:cover;border-radius:12px;background:#e0e7ff;cursor:pointer;" onclick="showImgPreview(this)">
        <div style="margin-top:6px;color:#6a82fb;font-weight:500;">场景2</div>
      </div>
      <div style="flex:1;display:flex;flex-direction:column;align-items:center;">
        <img src="img/场景3.jpeg" style="width:100%;height:120px;object-fit:cover;border-radius:12px;background:#e0e7ff;cursor:pointer;" onclick="showImgPreview(this)">
        <div style="margin-top:6px;color:#6a82fb;font-weight:500;">场景3</div>
      </div>
      <div style="flex:1;display:flex;flex-direction:column;align-items:center;">
        <img src="img/场景4.jpeg" style="width:100%;height:120px;object-fit:cover;border-radius:12px;background:#e0e7ff;cursor:pointer;" onclick="showImgPreview(this)">
        <div style="margin-top:6px;color:#6a82fb;font-weight:500;">场景4</div>
      </div>
    </div>
    <div style="font-weight:600;margin:32px 0 8px 0;">分镜剧情</div>
    <div id="shotsList"></div>
  </div>
  <button class="main-btn" style="margin-top:32px;" onclick="showPage('material')">下一步：生成图像</button>
  <!-- 大图预览弹窗 -->
  <div id="imgPreviewModal" style="display:none;position:fixed;z-index:9999;left:0;top:0;width:100vw;height:100vh;background:rgba(0,0,0,0.7);align-items:center;justify-content:center;">
    <img id="imgPreview" src="" style="max-width:80vw;max-height:80vh;border-radius:16px;box-shadow:0 8px 32px #0008;">
  </div>
</div>

<!-- 页面5：生成Clip短片 -->
<div id="clip" class="section" style="display:none;">
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:32px;">
    <div style="font-size:24px;font-weight:600;">生成Clip短片</div>
    <button onclick="showPage('storyboard')" style="padding:8px 16px;background:#6a82fb;color:white;border:none;border-radius:8px;cursor:pointer;font-weight:500;">返回</button>
  </div>
  <!-- 镜头选择条 -->
  <div style="position:relative;margin-bottom:32px;display:flex;justify-content:center;">
    <button onclick="scrollClipShots('left')" style="position:absolute;left:0;top:50%;transform:translateY(-50%);background:#6a82fb;color:white;border:none;border-radius:50%;width:40px;height:40px;cursor:pointer;font-size:22px;z-index:2;">&lt;</button>
    <div id="clipShotsContainer" style="width:1104px;max-width:100vw;overflow:hidden;position:relative;padding:16px 0;">
      <div id="clipShotsInner" style="display:flex;gap:24px;transition:transform 0.3s;will-change:transform;">
        <div class="clip-shot-thumb" data-index="0" onclick="selectClipShot(this)" style="width:260px;height:180px;background:#e0e7ff;border-radius:16px;cursor:pointer;display:flex;align-items:flex-start;justify-content:flex-start;position:relative;">
          <img src="img/1-1.jpeg" style="width:100%;height:100%;object-fit:cover;border-radius:16px;">
          <span style="position:absolute;left:14px;top:14px;color:#333;font-weight:500;background:rgba(255,255,255,0.7);border-radius:8px;padding:2px 12px;">镜头1</span>
        </div>
        <div class="clip-shot-thumb" data-index="1" onclick="selectClipShot(this)" style="width:260px;height:180px;background:#e0e7ff;border-radius:16px;cursor:pointer;display:flex;align-items:flex-start;justify-content:flex-start;position:relative;">
          <img src="img/2-1.jpeg" style="width:100%;height:100%;object-fit:cover;border-radius:16px;">
          <span style="position:absolute;left:14px;top:14px;color:#333;font-weight:500;background:rgba(255,255,255,0.7);border-radius:8px;padding:2px 12px;">镜头2</span>
        </div>
        <div class="clip-shot-thumb" data-index="2" onclick="selectClipShot(this)" style="width:260px;height:180px;background:#e0e7ff;border-radius:16px;cursor:pointer;display:flex;align-items:flex-start;justify-content:flex-start;position:relative;">
          <img src="img/3-1.jpeg" style="width:100%;height:100%;object-fit:cover;border-radius:16px;">
          <span style="position:absolute;left:14px;top:14px;color:#333;font-weight:500;background:rgba(255,255,255,0.7);border-radius:8px;padding:2px 12px;">镜头3</span>
        </div>
        <div class="clip-shot-thumb" data-index="3" onclick="selectClipShot(this)" style="width:260px;height:180px;background:#e0e7ff;border-radius:16px;cursor:pointer;display:flex;align-items:flex-start;justify-content:flex-start;position:relative;">
          <img src="img/4-1.jpeg" style="width:100%;height:100%;object-fit:cover;border-radius:16px;">
          <span style="position:absolute;left:14px;top:14px;color:#333;font-weight:500;background:rgba(255,255,255,0.7);border-radius:8px;padding:2px 12px;">镜头4</span>
        </div>
        <div class="clip-shot-thumb" data-index="4" onclick="selectClipShot(this)" style="width:260px;height:180px;background:#e0e7ff;border-radius:16px;cursor:pointer;display:flex;align-items:flex-start;justify-content:flex-start;position:relative;">
          <img src="img/5-1.jpeg" style="width:100%;height:100%;object-fit:cover;border-radius:16px;">
          <span style="position:absolute;left:14px;top:14px;color:#333;font-weight:500;background:rgba(255,255,255,0.7);border-radius:8px;padding:2px 12px;">镜头5</span>
        </div>
        <div class="clip-shot-thumb" data-index="5" onclick="selectClipShot(this)" style="width:260px;height:180px;background:#e0e7ff;border-radius:16px;cursor:pointer;display:flex;align-items:flex-start;justify-content:flex-start;position:relative;">
          <img src="img/6-1.jpeg" style="width:100%;height:100%;object-fit:cover;border-radius:16px;">
          <span style="position:absolute;left:14px;top:14px;color:#333;font-weight:500;background:rgba(255,255,255,0.7);border-radius:8px;padding:2px 12px;">镜头6</span>
        </div>
        <div class="clip-shot-thumb" data-index="6" onclick="selectClipShot(this)" style="width:260px;height:180px;background:#e0e7ff;border-radius:16px;cursor:pointer;display:flex;align-items:flex-start;justify-content:flex-start;position:relative;">
          <img src="img/7-1.jpeg" style="width:100%;height:100%;object-fit:cover;border-radius:16px;">
          <span style="position:absolute;left:14px;top:14px;color:#333;font-weight:500;background:rgba(255,255,255,0.7);border-radius:8px;padding:2px 12px;">镜头7</span>
        </div>
      </div>
    </div>
    <button onclick="scrollClipShots('right')" style="position:absolute;right:0;top:50%;transform:translateY(-50%);background:#6a82fb;color:white;border:none;border-radius:50%;width:40px;height:40px;cursor:pointer;font-size:22px;z-index:2;">&gt;</button>
  </div>
  <!-- 参考图+提示词左右布局 -->
  <div style="display:flex;justify-content:center;align-items:flex-start;gap:48px;margin-bottom:32px;">
    <div style="display:flex;flex-direction:column;align-items:center;width:400px;">
      <div style="align-self:flex-start;font-weight:600;font-size:1.08rem;color:#6a82fb;margin-bottom:8px;">参考图</div>
      <div id="clipRefImgBox" style="width:400px;height:260px;background:#e0e7ff;border-radius:18px;overflow:hidden;display:flex;align-items:center;justify-content:center;">
        <img id="clipRefImg" src="img/shot1-1.jpeg" style="width:100%;height:100%;object-fit:contain;border-radius:18px;">
      </div>
    </div>
    <div style="flex:1;min-width:260px;max-width:420px;">
      <div style="font-weight:600;margin-bottom:16px;">提示词</div>
      <div id="clipPromptText" style="width:100%;min-height:60px;max-height:600px;padding:16px;border:1.5px solid #e5e7eb;border-radius:10px;font-family:inherit;font-size:1.08rem;line-height:1.7;background:#fff;box-sizing:border-box;white-space:pre-wrap;word-break:break-all;"></div>
    </div>
  </div>
  <!-- 生成Clip按钮和进度条 -->
  <div style="margin-bottom:32px;">
    <button id="genClipBtn" style="width:100%;padding:12px;background:#6a82fb;color:white;border:none;border-radius:8px;cursor:pointer;font-weight:500;" onclick="generateClipVideos()">生成Clip</button>
    <button id="clipSubmitBtn" style="width:100%;padding:12px;background:#f3f4f6;color:#6a82fb;border:none;border-radius:8px;cursor:pointer;font-weight:500;margin-top:12px;">提交</button>
    <div id="clipProgressBar" style="width:100%;height:4px;background:#e0e7ff;border-radius:2px;margin-top:16px;display:none;">
      <div id="clipProgressFill" style="width:0%;height:100%;background:#6a82fb;border-radius:2px;transition:width 2s;"></div>
    </div>
  </div>
  <!-- 生成的Clip视频 -->
  <div id="generatedClips" style="display:none;margin-bottom:32px;">
    <div style="font-weight:600;margin-bottom:16px;">生成的Clip</div>
    <div id="clipGrid" style="display:grid;grid-template-columns:repeat(2,1fr);gap:16px;">
      <!-- 动态填充clip视频占位图 -->
    </div>
  </div>
</div>

<!-- 页面6：视频合成 -->
<div id="compose" class="section" style="display:none;min-height:400px;display:flex;align-items:center;justify-content:center;">
  <div style="width:100%;text-align:center;font-size:2.2rem;color:#6a82fb;font-weight:700;letter-spacing:2px;">敬请期待</div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // 页面切换函数
    function showPage(page) {
      console.log('Switching to page:', page); // 添加调试日志
      
      // 隐藏所有页面
      ['home', 'brief', 'material', 'storyboard', 'clip', 'compose'].forEach(function(id) {
        const element = document.getElementById(id);
        if (element) {
          if (id === page) {
            element.style.display = 'block';
            console.log('Showing element:', id); // 添加调试日志
          } else {
            element.style.display = 'none';
            console.log('Hiding element:', id); // 添加调试日志
          }
        } else {
          console.log('Element not found:', id); // 添加调试日志
        }
      });
      
      // 更新导航高亮
      document.querySelectorAll('.nav a').forEach(function(a) {
        const isActive = a.getAttribute('href') === '#' + page;
        a.classList.toggle('active', isActive);
        console.log('Nav link:', a.getAttribute('href'), 'active:', isActive); // 添加调试日志
      });
    }

    // 导航点击切换
    document.querySelectorAll('.nav a').forEach(function(a) {
      a.addEventListener('click', function(e) {
        e.preventDefault();
        const page = a.getAttribute('href').replace('#', '');
        console.log('Nav clicked:', page); // 添加调试日志
        showPage(page);
      });
    });

    // 页面加载时根据hash显示对应页面
    const hash = location.hash.replace('#', '') || 'home';
    console.log('Initial hash:', hash); // 添加调试日志
    showPage(hash);

    // hash变化时切换页面
    window.addEventListener('hashchange', function() {
      const hash = location.hash.replace('#', '') || 'home';
      console.log('Hash changed:', hash); // 添加调试日志
      showPage(hash);
    });
  });

  function importStoryboard() {
    document.getElementById('brandStory').value = '2026世界杯期间，时尚女孩身着潮流衣装，在赛场边精心喷上雅诗兰黛香水，那迷人芬芳瞬间飘散。赛后她走进赛场周边咖啡馆休息，活力男孩也因对足球的热爱踏入这里。女孩身上雅诗兰黛香水的独特气息吸引了男孩，两人因足球话题相谈甚欢。香水的芬芳在空气中弥漫，仿佛为这段相遇增添了浪漫滤镜。此后，他们的爱情如世界杯的热情般炽热甜蜜，雅诗兰黛香水见证了这段美好缘分。';
  }
  function generateStoryboard() {
    document.getElementById('storyboardProgress').style.display = '';
    document.getElementById('storyboardResult').style.display = 'none';
    let progress = 0;
    const bar = document.getElementById('progressBar');
    bar.style.width = '0%';
    const timer = setInterval(() => {
      progress += Math.random() * 20 + 10;
      if (progress >= 100) {
        progress = 100;
        clearInterval(timer);
        document.getElementById('storyboardProgress').style.display = 'none';
        document.getElementById('storyboardResult').style.display = '';
        renderShots();
      }
      bar.style.width = progress + '%';
    }, 400);
  }
  function renderShots() {
    const shots = [
      {title: '镜头1', desc: '1. 画面中，一位时尚女孩站在赛场边的角落，她身着时尚潮流的运动套装，背着一个小巧精致的背包。女孩神情兴奋，眼神中满是对比赛的期待。她从背包里拿出一瓶雅诗兰黛香水，轻轻拧开瓶盖，在手腕和脖颈处喷洒。那香水的液体晶莹剔透，喷洒出来的瞬间，细腻的雾状芬芳飘散在空气中，女孩闭上眼睛，享受着这迷人的香气。', imgs: ['img/1-1.jpeg', 'img/1-2.jpeg']},
      {title: '镜头2', desc: '2. 女孩比赛结束后，带着满足的笑容走进咖啡馆，找了个靠窗的位置坐下，点了一杯咖啡。不一会儿，一位活力男孩也走进了咖啡馆，他穿着印有球队标志的球衣，脸上洋溢着对足球的热情。男孩环顾四周，准备找个空位，这时，女孩身上雅诗兰黛香水的独特气息飘进了他的鼻子，他的目光不由自主地落在了女孩身上。', imgs: ['img/2-1.jpeg', 'img/2-2.jpeg']},
      {title: '镜头3', desc: '3. 男孩鼓起勇气走到女孩桌前，礼貌地询问是否可以坐下，女孩微笑着点头。两人开始聊起刚刚结束的比赛，越聊越投机，他们的眼神中都闪烁着光芒。此时，雅诗兰黛香水的芬芳在他们周围轻轻弥漫，仿佛为这个温馨的场景增添了一层浪漫的薄纱。桌上的咖啡冒着热气，与香水的香气交织在一起。', imgs: ['img/3-1.jpeg', 'img/3-2.jpeg']},
      {title: '镜头4', desc: '4. 正当两人聊得火热时，女孩的手机突然响起，她接起电话后，脸色变得有些担忧。原来家里有急事需要她马上回去。女孩抱歉地看着男孩，准备起身离开。男孩有些失落，眼神中流露出不舍。此时，窗外的大雨仿佛也在为这可能的分别增添了一丝忧伤的氛围，而雅诗兰黛香水的味道也似乎变得有些苦涩。', imgs: ['img/4-1.jpeg', 'img/4-2.jpeg']},
      {title: '镜头5', desc: '5. 女孩起身准备离开，男孩着急地拉住她的手，大声说："等雨停了再走吧。"女孩停下脚步，看着男孩真诚的眼神，心中一阵感动。两人站在门口，雨水在他们身边飞溅，而雅诗兰黛香水的芬芳在雨中更加浓郁。他们四目相对，气氛变得暧昧而浪漫。', imgs: ['img/5-1.jpeg', 'img/5-2.jpeg']},
      {title: '镜头6', desc: '6. 男孩和女孩手牵手走出咖啡馆，街道两旁的花朵在雨后显得格外娇艳。他们漫步在街道上，脸上都洋溢着幸福的笑容。雅诗兰黛香水的味道在他们身边萦绕，仿佛是他们爱情的见证。阳光洒在他们身上，形成了一幅美丽的画面。', imgs: ['img/6-1.jpeg', 'img/6-2.jpeg']},
      {title: '镜头7', desc: '7. 画面中，男孩和女孩的身影渐渐模糊，只剩下那瓶雅诗兰黛香水清晰地呈现在画面中央。香水在阳光下闪烁着光芒，旁边出现一行字幕："雅诗兰黛香水，见证2026世界杯的浪漫爱情。"', imgs: ['img/7-1.jpeg', 'img/7-2.jpeg']}
    ];
    const shotsList = document.getElementById('shotsList');
    shotsList.innerHTML = '';
    shots.forEach(shot => {
      shotsList.innerHTML += `
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:32px;">
          <div style="flex:0 0 90px;display:flex;align-items:center;justify-content:center;font-weight:600;font-size:1.15rem;color:#6a82fb;">${shot.title}</div>
          <div style="flex:1;max-width:32%;padding:0 18px 0 18px;display:flex;align-items:center;">${shot.desc}</div>
          <div style="flex:1.5;max-width:54%;display:flex;gap:18px;align-items:center;">
            <img src="${shot.imgs[0]}" style="width:48%;height:180px;object-fit:cover;border-radius:12px;background:#e0e7ff;cursor:pointer;" onclick="showImgPreview(this)">
            <img src="${shot.imgs[1]}" style="width:48%;height:180px;object-fit:cover;border-radius:12px;background:#e0e7ff;cursor:pointer;" onclick="showImgPreview(this)">
          </div>
        </div>
      `;
    });
  }
  function showImgPreview(imgEl) {
    var modal = document.getElementById('imgPreviewModal');
    var img = document.getElementById('imgPreview');
    img.src = imgEl.src;
    modal.style.display = 'flex';
    modal.onclick = function() { modal.style.display = 'none'; }
  }
  const shotPrompts = [
    '画面中，一位时尚女孩站在赛场边的角落，她身着时尚潮流的运动套装，背着一个小巧精致的背包。女孩神情兴奋，眼神中满是对比赛的期待。她从背包里拿出一瓶雅诗兰黛香水，轻轻拧开瓶盖，在手腕和脖颈处喷洒。那香水的液体晶莹剔透，喷洒出来的瞬间，细腻的雾状芬芳飘散在空气中，女孩闭上眼睛，享受着这迷人的香气。',
    '女孩比赛结束后，带着满足的笑容走进咖啡馆，找了个靠窗的位置坐下，点了一杯咖啡。不一会儿，一位活力男孩也走进了咖啡馆，他穿着印有球队标志的球衣，脸上洋溢着对足球的热情。男孩环顾四周，准备找个空位，这时，女孩身上雅诗兰黛香水的独特气息飘进了他的鼻子，他的目光不由自主地落在了女孩身上。',
    '男孩鼓起勇气走到女孩桌前，礼貌地询问是否可以坐下，女孩微笑着点头。两人开始聊起刚刚结束的比赛，越聊越投机，他们的眼神中都闪烁着光芒。此时，雅诗兰黛香水的芬芳在他们周围轻轻弥漫，仿佛为这个温馨的场景增添了一层浪漫的薄纱。桌上的咖啡冒着热气，与香水的香气交织在一起。',
    '正当两人聊得火热时，女孩的手机突然响起，她接起电话后，脸色变得有些担忧。原来家里有急事需要她马上回去。女孩抱歉地看着男孩，准备起身离开。男孩有些失落，眼神中流露出不舍。此时，窗外的大雨仿佛也在为这可能的分别增添了一丝忧伤的氛围，而雅诗兰黛香水的味道也似乎变得有些苦涩。',
    '女孩起身准备离开，男孩着急地拉住她的手，大声说："等雨停了再走吧。"女孩停下脚步，看着男孩真诚的眼神，心中一阵感动。两人站在门口，雨水在他们身边飞溅，而雅诗兰黛香水的芬芳在雨中更加浓郁。他们四目相对，气氛变得暧昧而浪漫。',
    '男孩和女孩手牵手走出咖啡馆，街道两旁的花朵在雨后显得格外娇艳。他们漫步在街道上，脸上都洋溢着幸福的笑容。雅诗兰黛香水的味道在他们身边萦绕，仿佛是他们爱情的见证。阳光洒在他们身上，形成了一幅美丽的画面。',
    '画面中，男孩和女孩的身影渐渐模糊，只剩下那瓶雅诗兰黛香水清晰地呈现在画面中央。香水在阳光下闪烁着光芒，旁边出现一行字幕："雅诗兰黛香水，见证2026世界杯的浪漫爱情。"'
  ];
  function scrollShots(direction) {
    const maxIndex = 3;
    const totalShots = 7;
    if (direction === 'left') {
      shotScrollIndex = Math.max(0, shotScrollIndex - 1);
    } else {
      shotScrollIndex = Math.min(totalShots - 4, shotScrollIndex + 1);
    }
    document.getElementById('shotsInner').style.transform = `translateX(-${shotScrollIndex * 284}px)`;
  }
  function selectShot(element) {
    // 选中高亮
    document.querySelectorAll('.shot-thumb').forEach(e => e.style.boxShadow = 'none');
    element.style.boxShadow = '0 0 0 3px #6a82fb';
    // 获取索引并显示提示词
    const idx = parseInt(element.getAttribute('data-index'));
    currentShotIndex = idx;
    document.getElementById('promptText').value = shotPrompts[idx] || '';
  }
  function generateImages() {
    const progressBar = document.getElementById('progressBar');
    const progressFill = document.getElementById('progressFill');
    const generatedImages = document.getElementById('generatedImages');
    const genImgGrid = document.getElementById('genImgGrid');
    progressBar.style.display = 'block';
    progressFill.style.width = '0%';
    generatedImages.style.display = 'block';
    genImgGrid.innerHTML = '';
    for(let i=0;i<4;i++){
      genImgGrid.innerHTML += `<div style='aspect-ratio:1;background:#e0e7ff;border-radius:12px;position:relative;overflow:hidden;cursor:pointer;' onclick='selectGeneratedImage(this, event)'></div>`;
    }
    setTimeout(() => {
      progressFill.style.width = '100%';
    }, 50);
    setTimeout(() => {
      genImgGrid.innerHTML = '';
      const shotNum = currentShotIndex + 1;
      for(let i=1;i<=4;i++){
        genImgGrid.innerHTML += `<div style='aspect-ratio:1;background:#e0e7ff;border-radius:12px;overflow:hidden;position:relative;cursor:pointer;' onclick='selectGeneratedImage(this, event)'><img src='img/shot${shotNum}-${i}.jpeg' style='width:100%;height:100%;object-fit:cover;border-radius:12px;'></div>`;
      }
      progressBar.style.display = 'none';
    }, 2000);
  }
  function selectGeneratedImage(element, event) {
    // 移除上一个工具栏
    if(lastImgToolbar) lastImgToolbar.remove();
    // 工具栏HTML（美化+新SVG图标）
    const toolbar = document.createElement('div');
    toolbar.className = 'img-toolbar';
    toolbar.innerHTML = `
      <button class='img-toolbar-btn' title='一键高清'>
        <svg width='22' height='22' viewBox='0 0 24 24' fill='none' stroke='#6a82fb' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><path d='M12 3v2M12 19v2M21 12h-2M5 12H3M17.657 6.343l-1.414 1.414M6.343 17.657l-1.414 1.414M17.657 17.657l-1.414-1.414M6.343 6.343L4.929 4.929M12 8a4 4 0 1 1 0 8a4 4 0 0 1 0-8z'/></svg>
      </button>
      <button class='img-toolbar-btn' title='一键换物' id='replace-item-btn'>
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#6a82fb" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="17 1 21 5 17 9"/><path d="M3 11V9a4 4 0 0 1 4-4h14"/><polyline points="7 23 3 19 7 15"/><path d="M21 13v2a4 4 0 0 1-4 4H3"/></svg>
      </button>
      <button class='img-toolbar-btn' title='一键换装'>
        <svg width='22' height='22' viewBox='0 0 24 24' fill='none' stroke='#6a82fb' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><path d='M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2'/><circle cx='12' cy='7' r='4'/></svg>
      </button>
    `;
    element.appendChild(toolbar);
    lastImgToolbar = toolbar;
    event.stopPropagation();

    // 一键换物按钮弹出浮层逻辑（浮层插入body并定位）
    const replaceBtn = toolbar.querySelector('#replace-item-btn');
    replaceBtn.onclick = function(e) {
      e.stopPropagation();
      // 若已存在浮层先移除
      const oldPopover = document.getElementById('replace-popover');
      if(oldPopover) oldPopover.remove();
      // 创建浮层
      const popover = document.createElement('div');
      popover.id = 'replace-popover';
      popover.className = 'replace-popover';
      popover.innerHTML = `
        <input class='replace-input' type='text' placeholder='请输入新物品，如"足球"' style='width:120px;'>
        <button class='replace-confirm'>确认</button>
      `;
      document.body.appendChild(popover);
      // 定位到图片上方中央
      const rect = element.getBoundingClientRect();
      const popoverRect = {width: 180, height: 36}; // 估算宽高
      popover.style.position = 'fixed';
      popover.style.left = (rect.left + rect.width/2 - popoverRect.width/2) + 'px';
      popover.style.top = (rect.top - popoverRect.height - 12) + 'px';
      popover.style.zIndex = '9999';

      // 点击浮层外自动关闭
      function handleDocClick(ev) {
        if (!popover.contains(ev.target)) {
          popover.remove();
          document.removeEventListener('mousedown', handleDocClick, true);
        }
      }
      setTimeout(()=>{
        document.addEventListener('mousedown', handleDocClick, true);
      }, 10);

      // 事件：确认关闭
      popover.querySelector('.replace-confirm').onclick = function(ev) {
        ev.stopPropagation();
        popover.remove();
        document.removeEventListener('mousedown', handleDocClick, true);
        // 仅对第一张图片做进度条和替换
        const img = element.querySelector('img');
        const isFirst = img && img.src && /shot1-1\.jpeg/.test(img.src);
        if(isFirst) {
          // 创建进度条
          let progressBar = element.querySelector('.replace-progress-bar');
          if(progressBar) progressBar.remove();
          progressBar = document.createElement('div');
          progressBar.className = 'replace-progress-bar';
          progressBar.innerHTML = `<div class='replace-progress-inner'></div>`;
          element.appendChild(progressBar);
          // 动画
          setTimeout(()=>{
            progressBar.querySelector('.replace-progress-inner').style.width = '100%';
          }, 30);
          setTimeout(()=>{
            progressBar.remove();
            img.src = 'img/shot1-change-beer.jpeg';
          }, 2030);
        }
      };
      // 回车也可确认
      popover.querySelector('.replace-input').onkeydown = function(ev) {
        if(ev.key==='Enter') {
          popover.querySelector('.replace-confirm').click();
        }
      };
      // 自动聚焦
      popover.querySelector('.replace-input').focus();
    };
  }
  // 点击空白处关闭工具栏
  document.addEventListener('click', function(e){
    if(lastImgToolbar && !lastImgToolbar.contains(e.target)){
      lastImgToolbar.remove();
      lastImgToolbar = null;
    }
  });
  function submitImage() {
    alert('图像已提交！');
  }
  function submitUpload() {
    // 直接根据 currentShotIndex 获取镜头
    const shotThumbs = document.querySelectorAll('.shot-thumb');
    const selected = shotThumbs[currentShotIndex];
    if (!selected) { alert('请先选择一个镜头'); return; }
    // 只给当前选中的镜头加勾，不移除其他勾
    let check = selected.querySelector('.shot-check');
    if (!check) {
      check = document.createElement('span');
      check.className = 'shot-check';
      check.innerHTML = '✔';
      check.style.cssText = 'position:absolute;right:10px;top:10px;color:#22c55e;font-size:1.6em;font-weight:bold;background:rgba(255,255,255,0.8);border-radius:50%;padding:2px 8px;z-index:3;';
      selected.appendChild(check);
    }
  }
  function scrollClipShots(direction) {
    const totalShots = 7;
    if (direction === 'left') {
      clipShotScrollIndex = Math.max(0, clipShotScrollIndex - 1);
    } else {
      clipShotScrollIndex = Math.min(totalShots - 4, clipShotScrollIndex + 1);
    }
    document.getElementById('clipShotsInner').style.transform = `translateX(-${clipShotScrollIndex * 284}px)`;
  }
  function selectClipShot(element) {
    document.querySelectorAll('.clip-shot-thumb').forEach(e => e.style.boxShadow = 'none');
    element.style.boxShadow = '0 0 0 3px #6a82fb';
    const idx = parseInt(element.getAttribute('data-index'));
    currentClipShotIndex = idx;
    let refImg = `img/shot${idx+1}-1.jpeg`;
    if(idx === 2) refImg = 'img/shot3-2.jpeg';
    document.getElementById('clipRefImg').src = refImg;
    // 提示词逻辑：用shotPrompts数组内容
    const div = document.getElementById('clipPromptText');
    div.textContent = shotPrompts[idx] || '';
  }
  function generateClipVideos() {
    const progressBar = document.getElementById('clipProgressBar');
    const progressFill = document.getElementById('clipProgressFill');
    const generatedClips = document.getElementById('generatedClips');
    const clipGrid = document.getElementById('clipGrid');
    // 显示进度条和占位
    progressBar.style.display = 'block';
    progressFill.style.width = '0%';
    generatedClips.style.display = 'block';
    clipGrid.innerHTML = '';
    selectedClipIndex = null;
    for(let i=0;i<4;i++){
      clipGrid.innerHTML += `<div class='clip-video-thumb' data-clip='${i}' style='aspect-ratio:1.6;background:#e0e7ff;border-radius:12px;overflow:hidden;display:flex;align-items:center;justify-content:center;cursor:pointer;'></div>`;
    }
    setTimeout(() => {
      progressFill.style.width = '100%';
    }, 50);
    setTimeout(() => {
      clipGrid.innerHTML = '';
      const shotNum = currentClipShotIndex + 1;
      for(let i=1;i<=4;i++){
        clipGrid.innerHTML += `<div class='clip-video-thumb' data-clip='${i-1}' onclick='selectClipVideo(this)' style='aspect-ratio:1.6;background:#e0e7ff;border-radius:12px;overflow:hidden;display:flex;align-items:center;justify-content:center;cursor:pointer;'><video src='video/shot${shotNum}-${i}.mp4' controls style='width:100%;height:100%;border-radius:12px;background:#000;'></video></div>`;
      }
      progressBar.style.display = 'none';
    }, 2000);
  }
  function selectClipVideo(el) {
    document.querySelectorAll('.clip-video-thumb').forEach(e => e.style.boxShadow = 'none');
    el.style.boxShadow = '0 0 0 3px #6a82fb';
    selectedClipIndex = parseInt(el.getAttribute('data-clip'));
  }
  document.getElementById('clipSubmitBtn').onclick = function() {
    // 只要选了clip就给当前镜头打勾
    if(selectedClipIndex === null) { alert('请先选择一个Clip视频'); return; }
    const shotThumbs = document.querySelectorAll('.clip-shot-thumb');
    const selected = shotThumbs[currentClipShotIndex];
    if (!selected) { alert('请先选择一个镜头'); return; }
    let check = selected.querySelector('.shot-check');
    if (!check) {
      check = document.createElement('span');
      check.className = 'shot-check';
      check.innerHTML = '✔';
      check.style.cssText = 'position:absolute;right:10px;top:10px;color:#22c55e;font-size:1.6em;font-weight:bold;background:rgba(255,255,255,0.8);border-radius:50%;padding:2px 8px;z-index:3;';
      selected.appendChild(check);
    }
  }
</script>
</body>
</html> 